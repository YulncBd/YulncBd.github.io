<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="君子见大水必观焉，何也？-- 其万折也必东，似志 ！">
<meta property="og:type" content="website">
<meta property="og:title" content="Try and try again！The worst result is failure!">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Try and try again！The worst result is failure!">
<meta property="og:description" content="君子见大水必观焉，何也？-- 其万折也必东，似志 ！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Try and try again！The worst result is failure!">
<meta name="twitter:description" content="君子见大水必观焉，何也？-- 其万折也必东，似志 ！">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Try and try again！The worst result is failure!</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Try and try again！The worst result is failure!</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-search">
          <a href="/search" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            搜索
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/22/iOS 中 Runtime 简单介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东折">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Try and try again！The worst result is failure!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/22/iOS 中 Runtime 简单介绍/" itemprop="url">iOS 中 runtime 简单介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-22T00:00:00+08:00">
                2016-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/22/iOS 中 Runtime 简单介绍/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/22/iOS 中 Runtime 简单介绍/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>runtime 总是一副很神秘的样子，就像盖着盖头的新娘，今天就揭下盖头看看新娘（runtime）究竟神秘样子！当然即使揭下盖头也只能看看新娘（runtime）的外貌，究竟内心是什么样的人，还需要长时间的相处去发现。</p>
<h2 id="什么-runtime"><a href="#什么-runtime" class="headerlink" title="什么 runtime"></a>什么 runtime</h2><p>runtime简称运行时，是一个c和汇编写的动态库，为 C 添加了面相对象的能力并创造了 Objective-C。也是系统运行时的一些机制，其中最主要的是消息机制。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C语言：函数的调用在编译时会决定调用哪个函数</span><br><span class="line">OC语言：动态调用，也就是说编译时并不能决定真正调用哪个函数，只有在运行时才会根据函数名找到相应的函数调用。</span><br></pre></td></tr></table></figure>
<h2 id="怎样使用-runtime"><a href="#怎样使用-runtime" class="headerlink" title="怎样使用 runtime"></a>怎样使用 runtime</h2><p>说了一些没用的废话，那么 runtime 是怎样来使用的呢？下面就简单介绍一下。</p>
<p>常用的头文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import &lt;objc/runtime.h&gt; 包含对类、成员变量、属性、方法的操作</span></span><br><span class="line"><span class="comment">#import &lt;objc/message.h&gt; 包含消息机制</span></span><br></pre></td></tr></table></figure>
<h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><p>OC 中方法调用的本质就是让对象发送消息。</p>
<p>比如在 OC 中这样调用方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 实例方法</span><br><span class="line">Person *p = [[Person alloc]init];</span><br><span class="line">[p eat];</span><br><span class="line"></span><br><span class="line">// 本质：让对象发送消息(在编译时会通过runtime 转换成下面的代码)</span><br><span class="line">objc_msgSend(p, @selector(eat));</span><br><span class="line"></span><br><span class="line">// 类方法</span><br><span class="line">[Person eat];</span><br><span class="line"></span><br><span class="line">// 本质：底层会把类名调用转换成对象调用，仍然是对象发送消息</span><br><span class="line">objc_msgSend([Person class], @selector(eat));</span><br></pre></td></tr></table></figure>
<p>消息传递的关键是编译器构建每个类和对象时采用的数据结构，每个类必须包含2个必要元素：</p>
<p>1.一个指向父类的指针</p>
<p>2.一个调度表（dispatch table）将类的selector（方法名） 与方法的实际内存地址关联起来。</p>
<p>每个对象都有一个指向其所属类的指针 isa 。</p>
<p>当对象发送消息时，objc_msgSend() 方法根据对象的 isa 指针找到对象的类，然后在类的调度表（dispatch table）中查找 selector ，如果没有找到，objc_msgSend() 方法通过指向父类的指针找到父类，然后在父类的调度表中查找 selector，以此类推直到找到 NSObject 类。一旦找到 selector ，objc_msgSend()方法根据调度表中 selector 的内存地址调用实现。</p>
<p>上面的方法每次都要查找整个调度表，如果类的方法很多，执行起来会消耗较多的时间。为了保证消息的发送与执行速度，系统会将使用过的 selector 会 方法的内存地址缓存起来，每个类都有一个缓存区域，包含当前类使用过的 selector 和父类中使用过的 selector。查找调度表之前，会先查找对象所属类的缓存。</p>
<p>当 selector 没有被实现时，会面临2中情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 使用 [p eat] 调用</span><br><span class="line">2. 使用 [p performSelector:@selector(eat)]; 调用</span><br></pre></td></tr></table></figure>
<p>第一种情况编译器会报错，第二种情况需要运行时才能确定对象能否接受到消息，这时会进入消息转发流程：</p>
<ul>
<li>消息转发流程</li>
</ul>
<p>1、动态方法解析<br>接收到未知消息时（假设person的eat方法尚未实现），runtime会调用+resolveInstanceMethod:（实例方法）或者+resolveClassMethod:（类方法），比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    NSString *s = NSStringFromSelector(sel);</span><br><span class="line">    <span class="keyword">if</span> ([s isEqualToString:@<span class="string">"eat"</span>]) &#123;</span><br><span class="line">        class_addMethod([Person class], @selector(eat), (IMP)eatFunc, <span class="string">"v@:"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void eatFunc(id self, SEL _cmd)</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@<span class="string">"hello"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单介绍一下 class_addMethod 方法的使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">OBJC_EXPORT BOOL class_addMethod(Class cls, SEL name, IMP imp, const char *types) </span><br><span class="line">参数说明：</span><br><span class="line"></span><br><span class="line">cls：被添加方法的类，这里不要使用object_getClass(self)，而是使用 [Person class] 来获取当前类</span><br><span class="line"></span><br><span class="line">name：未实现的方法名，比如我的eat方法未实现，这里就用eat</span><br><span class="line"></span><br><span class="line">imp：转发的函数，函数名随便命名，比如这里就是eatFunc</span><br><span class="line"></span><br><span class="line">types：一个定义该函数返回值类型和参数类型的字符串</span><br><span class="line"></span><br><span class="line">这里的<span class="built_in">type</span>为“v@:”</span><br><span class="line">v ：表示返回值为void ，若是 i 则表示 返回值类型为 int</span><br><span class="line">@ ：参数 id(self)</span><br><span class="line">: : SEL(_cmd)</span><br></pre></td></tr></table></figure>
<p>2、备用接收者<br>如果以上方法没有做处理，runtime会调用- (id)forwardingTargetForSelector:(SEL)aSelector方法。<br>如果该方法返回了一个非nil（也不能是self）的对象，而且该对象实现了这个方法，那么这个对象就成了消息的接收者，消息就被分发到该对象。<br>适用情况：通常在对象内部使用，让内部的另外一个对象处理消息，在外面看起来就像是该对象处理了消息。<br>比如：person 让女朋友 personGirlFriend 来接收这个消息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    NSString * s = NSStringFromSelector(aSelector);</span><br><span class="line">    <span class="keyword">if</span> ([s isEqualToString:@<span class="string">"eat"</span>]) &#123;</span><br><span class="line">        <span class="built_in">return</span> self. personGirlFriend;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> [super forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、完整消息转发<br>在- (void)forwardInvocation:(NSInvocation *)anInvocation方法中选择转发消息的对象，其中anInvocation对象封装了未知消息的所有细节，并保留调用结果发送到原始调用者。<br>比如：person将消息完整转发給父母 PersonParent来处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation &#123;</span><br><span class="line">    <span class="keyword">if</span> ([PersonParent instancesRespondToSelector:anInvocation.selector]) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:self. personParent];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、如果在以上三个方法都没有处理未知消息，则会引发异常。</p>
<h3 id="遍历对象属性"><a href="#遍历对象属性" class="headerlink" title="遍历对象属性"></a>遍历对象属性</h3><p>OC 中成员变量的实质什么？方法的实质又是什么？类的实质又是什么？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/// An opaque <span class="built_in">type</span> that represents a method <span class="keyword">in</span> a class definition.</span><br><span class="line">typedef struct objc_method *Method;</span><br><span class="line"></span><br><span class="line">/// An opaque <span class="built_in">type</span> that represents an instance variable.</span><br><span class="line">typedef struct objc_ivar *Ivar;</span><br><span class="line"></span><br><span class="line">/// An opaque <span class="built_in">type</span> that represents a category.</span><br><span class="line">typedef struct objc_category *Category;</span><br><span class="line"></span><br><span class="line">/// An opaque <span class="built_in">type</span> that represents an Objective-C declared property.</span><br><span class="line">typedef struct objc_property *objc_property_t;</span><br><span class="line"></span><br><span class="line">-------------------------------------------------</span><br><span class="line">从上面可以看出：</span><br><span class="line">成员变量的实质是一个指向 objc_ivar 结构体的指针。</span><br><span class="line">方法的实质是一个指向 objc_method 结构体的指针</span><br><span class="line">属性变量的实质是一个指向 objc_property 结构体的指针</span><br><span class="line"></span><br><span class="line">/// An opaque <span class="built_in">type</span> that represents an Objective-C class.</span><br><span class="line">typedef struct objc_class *Class;</span><br><span class="line"></span><br><span class="line">类的实质就是一个指向 objc_class 结构体的指针</span><br></pre></td></tr></table></figure>
<ul>
<li>使用方法</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">// 对成员变量的一些操作</span><br><span class="line">- (void)getIvarList:(id)object</span><br><span class="line">&#123;</span><br><span class="line">    u_int count;</span><br><span class="line">    // class_copyIvarList 获取所有成员变量（包括property属性）</span><br><span class="line">    Ivar *lists = class_copyIvarList(object_getClass(object), &amp;count);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (int i=0; i&lt;count; i++) &#123;</span><br><span class="line">        // 成员变量</span><br><span class="line">        Ivar list = lists[i];</span><br><span class="line">        // 变量名</span><br><span class="line">        const char *name = ivar_getName(list);</span><br><span class="line">        // 变量类型</span><br><span class="line">        const char *<span class="built_in">type</span> = ivar_getTypeEncoding(list);</span><br><span class="line">        // 获取指定名称的成员变量</span><br><span class="line">        Ivar sList = class_getClassVariable(object_getClass(object), <span class="string">"listName"</span>);</span><br><span class="line">        // 获取某个成员变量的值</span><br><span class="line">        id value = object_getIvar(object_getClass(object), sList);</span><br><span class="line">        // 为某个成员变量赋值</span><br><span class="line">        id reValue = (id)@<span class="string">"RENAME"</span>;</span><br><span class="line">        object_<span class="built_in">set</span>Ivar(object_getClass(object), sList, reValue);</span><br><span class="line">    &#125;</span><br><span class="line">    // 需要手动释放</span><br><span class="line">    free(lists);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 对属性列表的一些操作</span><br><span class="line">- (void)getProperty:(id)object</span><br><span class="line">&#123;</span><br><span class="line">    u_int count;</span><br><span class="line">    // class_copyPropertyList 获取属性列表</span><br><span class="line">    objc_property_t *properties = class_copyPropertyList(object_getClass(object), &amp;count);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (int i=0; i&lt;count; i++) &#123;</span><br><span class="line">        // 属性</span><br><span class="line">        objc_property_t property = properties[i];</span><br><span class="line">        // 属性名</span><br><span class="line">        const char *name = property_getName(property);</span><br><span class="line">        // 属性类型</span><br><span class="line">        const char *<span class="built_in">type</span> = property_getAttributes(property);</span><br><span class="line">        // 获取属性的修饰词</span><br><span class="line">        u_int outCount;</span><br><span class="line">        objc_property_t *types = property_copyAttributeList(property, &amp;outCount);</span><br><span class="line">    &#125;</span><br><span class="line">    // 需要手动释放</span><br><span class="line">    free(properties);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用实例1</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">// 将json 数据转换成model</span><br><span class="line"></span><br><span class="line">// 方法一：</span><br><span class="line">- (void)method1:(NSDictionary *)dic</span><br><span class="line">&#123;</span><br><span class="line">    // 必须类型一一对应，不然有可能报错，比如字典中name是@(1234)NSNumber类型，model中name是NSString类型，如果调用name.length 程序就会报错。</span><br><span class="line">    // 使用系统方法</span><br><span class="line">    [self <span class="built_in">set</span>ValuesForKeysWithDictionary:dic];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 针对上面说的问题的解决方案</span><br><span class="line"></span><br><span class="line">// 创建一个NSNumber 的类目</span><br><span class="line"></span><br><span class="line">// 解决方案一：runtime（方法转移）</span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    NSString *s = NSStringFromSelector(sel);</span><br><span class="line">    <span class="keyword">if</span> ([s isEqualToString:@<span class="string">"length"</span>]) &#123;</span><br><span class="line">        class_addMethod([NSNumber class], @selector(length), (IMP)lengthFunc, <span class="string">"v@:"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int lengthFunc(id self, SEL _cmd)</span><br><span class="line">&#123;</span><br><span class="line">    NSString *s = [NSString stringWithFormat:@<span class="string">"%@"</span>,self];</span><br><span class="line">    <span class="built_in">return</span> (int)s.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 解决方案二：添加一个叫length的方法</span><br><span class="line">- (int)length</span><br><span class="line">&#123;</span><br><span class="line">    NSString *s = [NSString stringWithFormat:@<span class="string">"%@"</span>,self];</span><br><span class="line">    <span class="built_in">return</span> (int)s.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 方法二：</span><br><span class="line">- (void)method2:(NSDictionary *)dic</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableDictionary *keys = [NSMutableDictionary dictionary];</span><br><span class="line">    u_int count;</span><br><span class="line">    objc_property_t *propertyLists = class_copyPropertyList(object_getClass(self), &amp;count);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (int i=0; i&lt;count; i++) &#123;</span><br><span class="line">    </span><br><span class="line">        objc_property_t propertyList = propertyLists[i];</span><br><span class="line">        NSString *propertyName = [NSString stringWithCString:property_getName(propertyList) encoding:NSUTF8StringEncoding];</span><br><span class="line">        NSString *propertyType = [NSString stringWithCString:property_getAttributes(propertyList) encoding:NSUTF8StringEncoding];</span><br><span class="line">        </span><br><span class="line">        // propertyType 的各个值的意义</span><br><span class="line">        //属性类型  name值：T  value：变化</span><br><span class="line">        //编码类型  name值：C(copy) &amp;(strong) W(weak) 空(assign) 等 value：无</span><br><span class="line">        //非/原子性 name值：空(atomic) N(Nonatomic)  value：无</span><br><span class="line">        //变量名称  name值：V  value：变化</span><br><span class="line"></span><br><span class="line">        // 裁剪类型字符串，不适用基本数据类型，只适用NSString，NSNumber，etc</span><br><span class="line">        NSRange range = [propertyType rangeOfString:@<span class="string">"\""</span>];</span><br><span class="line">        propertyType = [propertyType substringFromIndex:range.location + range.length];</span><br><span class="line">        range = [propertyType rangeOfString:@<span class="string">"\""</span>];</span><br><span class="line">        // 裁剪到哪个角标，不包括当前角标</span><br><span class="line">        propertyType = [propertyType substringToIndex:range.location];</span><br><span class="line">        </span><br><span class="line">        [keys <span class="built_in">set</span>Object:propertyType <span class="keyword">for</span>Key:propertyName];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    free(propertyLists);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (NSString *key <span class="keyword">in</span> [keys allKeys]) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ([dic objectForKey:key]) &#123;</span><br><span class="line">            </span><br><span class="line">            NSString *<span class="built_in">type</span> = [keys objectForKey:key];</span><br><span class="line">            <span class="keyword">if</span> ([<span class="built_in">type</span> isEqualToString:@<span class="string">"NSString"</span>]) &#123;</span><br><span class="line"></span><br><span class="line">                NSString* value = [NSString stringWithFormat:@<span class="string">"%@"</span>,[dic objectForKey:key]];</span><br><span class="line">                [self <span class="built_in">set</span>Value:value <span class="keyword">for</span>Key:key];</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ([<span class="built_in">type</span> isEqualToString:@<span class="string">"NSNumber"</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                NSNumber *value = [dic objectForKey:key];</span><br><span class="line">                // __NSCFString,__NSCFNumber,__NSCFBoolean,__NSCFArray,__NSCFDictionary</span><br><span class="line">                <span class="keyword">if</span> ([value isKindOfClass:NSClassFromString(@<span class="string">"__NSCFString"</span>)]) &#123;</span><br><span class="line">                    // @<span class="string">"12"</span></span><br><span class="line">                    value = value;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([value isKindOfClass:NSClassFromString(@<span class="string">"__NSCFNumber"</span>)])&#123;</span><br><span class="line">                    // @(12),@(12.3),etc</span><br><span class="line">                    value = @([value <span class="built_in">float</span>Value]);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([value isKindOfClass:NSClassFromString(@<span class="string">"__NSCFBoolean"</span>)])</span><br><span class="line">                &#123;   // @(YES),@(NO)</span><br><span class="line">                    value = @([value boolValue]);</span><br><span class="line">                &#125;</span><br><span class="line">                [self <span class="built_in">set</span>Value:value <span class="keyword">for</span>Key:key];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 方法三：找一个比较好的第三方库。</span><br></pre></td></tr></table></figure>
<ul>
<li>使用实例2</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 有时想查看model各个属性的值，但是调试时打印出来的却是一个地址，那么怎样解决这个问题呢？重写debugDescription方法。</span><br><span class="line"></span><br><span class="line">- (NSString *)debugDescription</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableDictionary *dictionary = [NSMutableDictionary dictionary];</span><br><span class="line">    u_int count;</span><br><span class="line">    objc_property_t *properties = class_copyPropertyList([self class], &amp;count);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (int i = 0; i&lt;count; i++) &#123;</span><br><span class="line">        objc_property_t property = properties[i];</span><br><span class="line">        NSString *name = @(property_getName(property));</span><br><span class="line">        id value = [self valueForKey:name]?:@<span class="string">"nil"</span>;</span><br><span class="line">        [dictionary <span class="built_in">set</span>Object:value <span class="keyword">for</span>Key:name];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    free(properties);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> [NSString stringWithFormat:@<span class="string">"&lt;%@: %p&gt; %@"</span>,[self class],self,dictionary];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加属性与方法"><a href="#添加属性与方法" class="headerlink" title="添加属性与方法"></a>添加属性与方法</h3><p>该如何给系统的类（比如UIButton）添加一个属性或者方法呢？你可能想到了继承。但是如果不能用继承呢？你也许还会想到分类，但是分类只能添加方法不能添加属性啊，不要着急runtime 来了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 如何为系统的类添加属性</span><br><span class="line"></span><br><span class="line">方案一：继承</span><br><span class="line"></span><br><span class="line">方案二：分类+runtime（只用分类不能添加属性）</span><br><span class="line"></span><br><span class="line">// 创建UIButton 的分类</span><br><span class="line"></span><br><span class="line">// .h 文件</span><br><span class="line">@property (nonatomic, strong) NSString *url;</span><br><span class="line"></span><br><span class="line">// .m 文件</span><br><span class="line">- (void)<span class="built_in">set</span>Url:(NSString *)url</span><br><span class="line">&#123;</span><br><span class="line">    // 关联对象</span><br><span class="line">    objc_<span class="built_in">set</span>AssociatedObject(self, @selector(url), url, OBJC_ASSOCIATION_COPY);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSString *)url&#123;</span><br><span class="line">    // 获取关联对象</span><br><span class="line">    <span class="built_in">return</span> objc_getAssociatedObject(self, @selector(url));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 然后就可以访问buton 的 url 属性了，如果需要移除关联对象，将关联对象的值设为nil 即可。</span><br><span class="line"></span><br><span class="line">// 当然如果只是在一个类中使用button 的 url 属性， 那么没必要建一个分类，直接在调用类中实现：</span><br><span class="line"></span><br><span class="line">// 设置关联</span><br><span class="line">objc_<span class="built_in">set</span>AssociatedObject(button, @<span class="string">"link"</span>, @<span class="string">"这是链接测试"</span>, OBJC_ASSOCIATION_COPY);</span><br><span class="line">// 获取关联的值</span><br><span class="line">NSString *link = objc_getAssociatedObject(button, @<span class="string">"link"</span>);</span><br><span class="line"></span><br><span class="line">// 添加方法：继承，分类，runtime（见上面的描述）</span><br></pre></td></tr></table></figure>
<h3 id="方法交换"><a href="#方法交换" class="headerlink" title="方法交换"></a>方法交换</h3><p>有些时候我们希望有自己的方法取代系统的方法（按照自己的方法实现，或者防止程序崩溃），比如防止数组越界或者传入值为nil 时，系统的崩溃。</p>
<p>改变系统方法的实现的方式有：继承，分类（类目），这里再说一种方法的交换。具体需要那种方式自己去判断。</p>
<p>方法交换的相关函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 通过方法名获取方法</span><br><span class="line">class_getInstanceMethod(&lt;<span class="comment">#__unsafe_unretained Class cls#&gt;, &lt;#SEL name#&gt;)</span></span><br><span class="line"></span><br><span class="line">// 获取一个方法的实现</span><br><span class="line">method_getImplementation(&lt;<span class="comment">#Method m#&gt;)</span></span><br><span class="line"></span><br><span class="line">// 获取一个OC实现的编码类型</span><br><span class="line">method_getTypeEncoding(&lt;<span class="comment">#Method m#&gt;)</span></span><br><span class="line"></span><br><span class="line">// 添加一个方法</span><br><span class="line">class_addMethod(__unsafe_unretained Class cls, &lt;<span class="comment">#SEL name#&gt;, &lt;#IMP imp#&gt;, &lt;#const char *types#&gt;)</span></span><br><span class="line"></span><br><span class="line">// 用一个方法的实现替换</span><br><span class="line">class_replaceMethod(&lt;<span class="comment">#__unsafe_unretained Class cls#&gt;, &lt;#SEL name#&gt;, &lt;#IMP imp#&gt;, &lt;#const char *types#&gt;)</span></span><br><span class="line"></span><br><span class="line">// 交换2个方法的实现</span><br><span class="line">method_exchangeImplementations(&lt;<span class="comment">#Method m1#&gt;, &lt;#Method m2#&gt;)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用实例</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">// 防止数组越界</span><br><span class="line">+ (void)load</span><br><span class="line">&#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">    </span><br><span class="line">        Method method1 = class_getInstanceMethod(objc_getClass(<span class="string">"__NSArrayI"</span>), @selector(objectAtIndex:));</span><br><span class="line">        Method method2 = class_getInstanceMethod(objc_getClass(<span class="string">"__NSArrayI"</span>), @selector(z_objectAtIndex:));</span><br><span class="line">        method_exchangeImplementations(method1, method2); </span><br><span class="line">    &#125;); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)z_objectAtIndex:(NSUInteger)index</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@<span class="string">"~~~~~~~:%ld"</span>,count);</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= self.count) &#123;</span><br><span class="line">        <span class="built_in">return</span> @<span class="string">"haha"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">       <span class="built_in">return</span>  [self z_objectAtIndex:index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 上面的写法能解决数组越界的问题，但是z_objectAtIndex: 方法会调用很多次，而且个一段时间就会调用几次，不清楚为什么。是就是这样的机制，还是写法有误？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 替换imageNamed 方法</span><br><span class="line">+ (void) load</span><br><span class="line">&#123;</span><br><span class="line">    Method method1 = class_getClassMethod([UIImage class], @selector(imageNamed:));</span><br><span class="line">    Method method2 = class_getClassMethod([UIImage class], @selector(z_imageNamed:));</span><br><span class="line">    </span><br><span class="line">    method_exchangeImplementations(method1, method2);</span><br><span class="line">//    IMP imp1 = method_getImplementation(method1);</span><br><span class="line">//    IMP imp2 = method_getImplementation(method2);</span><br><span class="line">//    method_<span class="built_in">set</span>Implementation(method1, imp2);</span><br><span class="line">//    method_<span class="built_in">set</span>Implementation(method2, imp1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (UIImage *)z_imageNamed:(NSString *)name</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@<span class="string">"修改名字"</span>);</span><br><span class="line">    <span class="built_in">return</span>  [self z_imageNamed:@<span class="string">"name"</span>];</span><br><span class="line">&#125;</span><br><span class="line">// 这里的z_imageNamed：就只会调用一次。</span><br></pre></td></tr></table></figure>
<p><a href="http://www.jianshu.com/p/8e562c24039e" target="_blank" rel="external">如何防止button的连点</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>经过上面的学习，只能说对 runtime 有了一些了解，能够简单的使用一下，如果想要更深入的了解 runtime 还需要持续不断的深入学习。</p>
<p>参考博客：</p>
<p><a href="http://blog.devtang.com/2013/10/15/objective-c-object-model/" target="_blank" rel="external">Objective-C对象模型及应用</a></p>
<p><a href="http://blog.devwu.com/develop/2014-08-18/objcruntime-explore3/" target="_blank" rel="external">objc/runtime 探索</a></p>
<p><a href="http://www.tuicool.com/articles/Av63EfJ" target="_blank" rel="external">iOS开发教程之Objc Runtime笔记</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/20/NSLog使用 与 LLDB命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东折">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Try and try again！The worst result is failure!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/20/NSLog使用 与 LLDB命令/" itemprop="url">NSLog使用 与 LLDB命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-20T00:00:00+08:00">
                2016-06-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/20/NSLog使用 与 LLDB命令/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/20/NSLog使用 与 LLDB命令/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>调试是程序开发的重要的功能组成部分，可以用来发现程序出存在的问题，快速定位及解决，调试也可以辅助更好的理解程序。事实上，调试最初就是为了解决问题而产生的，调试的英文为debug， 而bug就是程序中存在的问题，debug就是解决掉这些问题。</p>
<blockquote>
<p>1.调试的功能：</p>
<p>在调试中，程序的每一步的执行均是可控的，可以通过单步执行，设置断点等，控制程序的运行节奏，并在每次暂停时，都可以查看当前有效变量的具体值。</p>
<p>2.对初学者的意义：</p>
<p>调试中可以很明确的看到程序的执行过程，以及每一步产生的变化，对于初学者，这样直观的体验自然要比读代码更容易理解，而看到现象之后，再回想理论也更容易。</p>
<p>3.对编程者的意义：</p>
<p>当程序的运行结果与期望不符时，可以通过调试，查看每步的具体执行及结果，因此可以定位出到底是哪个操作或语句与预期的不同，从而快速定位，再针对性分析代码，实现快速解决问题的目的。</p>
</blockquote>
<h2 id="NSLog-使用"><a href="#NSLog-使用" class="headerlink" title="NSLog 使用"></a>NSLog 使用</h2><p>在XCode做开发调试时往往需要打印一些调试信息做debug用</p>
<h3 id="NSLog-性能问题"><a href="#NSLog-性能问题" class="headerlink" title="NSLog 性能问题"></a>NSLog 性能问题</h3><p>它的运行会占用时间和设备资源。当打印信息的地方多了之后在模拟器上跑可能不会有什么问题，因为模拟器用的是电脑的硬件，但是当应用跑在设备上时这些输出语句会在很大程度上影响应用的性能，而且输出的数据也可能会暴露出App里的保密数据，所以发布正式版时需要把这些输出全部屏蔽掉，针对这种问题可以写一些宏来控制这些调试信息的输出。</p>
<p>解决方案：</p>
<blockquote>
<p>简单粗暴的解决方案：在APP release前，将所有的NSLog注释掉，简单有效，但副作用是：下次你要调试时，又得将NSLog一个个取消注释。</p>
<p>正确的解决方案：你以release模式编译的程序不会用NSLog输出，而你以debug模式编译的程序将执行NSLog的全部功能。 在release版本禁止输出NSLog内容。</p>
</blockquote>
<p>如何实现？</p>
<ol>
<li>在 xxx.pch (预编译文件) 中添加以下代码：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//用宏指令做一个判断，如果DEBUG为真，则编译<span class="comment">#ifdef到#endif宏定义，否则编译器就不编译；</span></span><br><span class="line"><span class="comment">#ifdef DEBUG  </span></span><br><span class="line"><span class="comment">#define NSLog(...) NSLog(__VA_ARGS__)  </span></span><br><span class="line"><span class="comment">#define debugMethod() NSLog(@"%s", __func__)  </span></span><br><span class="line"><span class="comment">#else  </span></span><br><span class="line"><span class="comment">#define NSLog(...)  </span></span><br><span class="line"><span class="comment">#define debugMethod()  </span></span><br><span class="line"><span class="comment">#endif</span></span><br></pre></td></tr></table></figure>
<ol>
<li>设置DEBUG</li>
</ol>
<p>在 “Target &gt; Build Settings &gt; Preprocessor Macros &gt; Debug” 里有一个”DEBUG=1”。</p>
<p>设置为Debug模式下，点击Product –&gt; Scheme –&gt; Edit Scheme</p>
<p>设置run –&gt; info –&gt; Build Configuration成Debug时，就可以打印nslog了。</p>
<p>设置Release，发布app版本的时候就不会打印了，提高了性能。</p>
<h3 id="如何自定义输入"><a href="#如何自定义输入" class="headerlink" title="如何自定义输入"></a>如何自定义输入</h3><p>在 xxx.pch 中添加以下代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ifdef DEBUG</span></span><br><span class="line"><span class="comment">#define NSLog(format, ...) fprintf(stderr, "class：%s \nline： %d \nmethod：%s \nmessage：%s \n%s \n",[[[NSString stringWithUTF8String:__FILE__] lastPathComponent] UTF8String],__LINE__, __func__,[[NSString stringWithFormat:format, ##__VA_ARGS__] UTF8String], [@"----------------------------------------------" UTF8String]);</span></span><br><span class="line"><span class="comment">#else</span></span><br><span class="line"><span class="comment">#define NSLog(format, ...)</span></span><br><span class="line"><span class="comment">#endif</span></span><br></pre></td></tr></table></figure>
<p>可以根据个人需要调整上面代码，主要就是这几个宏 ##__VA_ARGS<strong> , \</strong>FILE<strong> , \</strong>LINE<strong> 和\</strong>FUNCTION__。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1) __VA_ARGS__ 是一个可变参数的宏，很少人知道这个宏，这个可变参数的宏是新的C99规范中新增的，目前似乎只有gcc支持（VC6.0的编译器不支持）。宏前面加上<span class="comment">##的作用在于，当可变参数的个数为0时，这里的##起到把前面多余的","去掉的作用,否则会编译出错, 你可以试试。</span></span><br><span class="line">2) __FILE__ 宏在预编译时会替换成当前的源文件名</span><br><span class="line">3) __LINE__宏在预编译时会替换成当前的行号</span><br><span class="line">4) __FUNCTION__宏在预编译时会替换成当前的函数名称</span><br><span class="line">5) __func__ 打印当前函数或方法，c字符串</span><br></pre></td></tr></table></figure>
<h3 id="将Log日志重定向输出到文件"><a href="#将Log日志重定向输出到文件" class="headerlink" title="将Log日志重定向输出到文件"></a>将Log日志重定向输出到文件</h3><p>对于真机，日志没法保存，不好分析问题。所以有必要将日志保存到应用的Docunment目录下，并设置成共享文件，这样才能取出分析。</p>
<p>首先是日志输出，分为c的printf和标准的NSLog输出，printf会向标准输出(sedout)打印，而NSLog则是向标准出错(stderr)，我们需要同时让他们都将日志打印到一个文件中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//例子：</span><br><span class="line">freopen(<span class="string">"xx.log"</span>,<span class="string">"a+"</span>,stdout);</span><br><span class="line">freopen(<span class="string">"xx.log"</span>,<span class="string">"a+"</span>,stderr);</span><br></pre></td></tr></table></figure>
<p>具体做法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 将NS<span class="built_in">log</span>打印信息保存到Document目录下的文件中</span><br><span class="line">- (void)redirectNS<span class="built_in">log</span>ToDocumentFolder</span><br><span class="line">&#123;</span><br><span class="line">    NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</span><br><span class="line">    NSString *documentDirectory = [paths objectAtIndex:0];</span><br><span class="line">    NSString *<span class="built_in">log</span>FilePath = [documentDirectory stringByAppendingPathComponent:@<span class="string">"log.txt"</span>];</span><br><span class="line">    </span><br><span class="line">    // 先删除已经存在的文件</span><br><span class="line">    NSFileManager *defaultManager = [NSFileManager defaultManager];</span><br><span class="line">    [defaultManager removeItemAtPath:<span class="built_in">log</span>FilePath error:nil];</span><br><span class="line">    </span><br><span class="line">    // 将<span class="built_in">log</span>输入到文件</span><br><span class="line">    freopen([<span class="built_in">log</span>FilePath cStringUsingEncoding:NSASCIIStringEncoding], <span class="string">"a+"</span>, stdout);</span><br><span class="line">    freopen([<span class="built_in">log</span>FilePath cStringUsingEncoding:NSASCIIStringEncoding], <span class="string">"a+"</span>, stderr);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">此函数要在- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions中调用。</span><br></pre></td></tr></table></figure>
<p>当连接Mac调试的时候把这些注释掉，否则log只会输入到文件中，而不能从xcode的监视器中看到。</p>
<p> 最后配置共享文件夹：</p>
<p>在应用程序的Info.plist文件中添加UIFileSharingEnabled键（Application supports iTunes file sharing 键），并将键值设置为YES。将您希望共享的文件放在应用程序的 Documents目录。一旦设备插入到用户计算机，iTunes 9.1就会在选中设备的Apps标签中找到自己的应用，查看共享内容，找到 log.txt 文件。</p>
<h2 id="断言NSAssert-的使用"><a href="#断言NSAssert-的使用" class="headerlink" title="断言NSAssert()的使用"></a>断言NSAssert()的使用</h2><p>NSAssert()只是一个宏，用于开发阶段调试程序中的Bug，通过为NSAssert()传递条件表达式来断定是否属于Bug，满足条件返回真值，程序继续运行，如果返回假值，则抛出异常，并切可以自定义异常描述。NSAssert()是这样定义的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define NSAssert(condition, desc)</span></span><br></pre></td></tr></table></figure>
<p>condition是条件表达式，值为YES或NO；desc为异常描述，通常为NSString。当conditon为YES时程序继续运行，为NO时，则抛出带有desc描述的异常信息。NSAssert()可以出现在程序的任何一个位置。具体事例如下：</p>
<p>生成一个LotteryEntry对象时，传入的NSDate不能为nil，加入NSAssert()判断。对象初始化源码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (id)initWithEntryDate:(NSDate *)theDate &#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    <span class="keyword">if</span> (self) &#123;</span><br><span class="line">        NSAssert(theDate != nil, @<span class="string">"Argument must be non-nil"</span>);</span><br><span class="line">        entryDate = theDate;</span><br><span class="line">        firstNumber = (int)random() % 100 + 1;</span><br><span class="line">        secondNumber = (int)random() % 100 + 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span>  self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来则是生成对象时传入一个值为nil的NSDate，看断言是否运行。</p>
<p>LotteryEntry *nilEntry = [[LotteryEntry alloc] initWithEntryDate:nil];</p>
<p><strong>断言效果如下：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2013-01-17 20:49:12.486 lottery[3951:303] *** Terminating app due to uncaught exception <span class="string">'NSInternalInconsistencyException'</span>, reason: <span class="string">'Argument must be non-nil'</span></span><br><span class="line"></span><br><span class="line">*** First throw call stack:</span><br><span class="line">(</span><br><span class="line">0   CoreFoundation                      0x00007fff90c590a6 __exceptionPreprocess + 198</span><br><span class="line">1   libobjc.A.dylib                     0x00007fff8fd2a3f0 objc_exception_throw + 43</span><br><span class="line">2   CoreFoundation                      0x00007fff90c58ee8 +[NSException raise:format:arguments:] + 104</span><br><span class="line">3   Foundation                          0x00007fff88dae6a2 -[NSAssertionHandler handleFailureInMethod:object:file:lineNumber:description:] + 189</span><br><span class="line">4   lottery                             0x0000000100001929 -[LotteryEntry initWithEntryDate:] + 249</span><br><span class="line">5   lottery                             0x0000000100001794 main + 932</span><br><span class="line">6   libdyld.dylib                       0x00007fff8d83f7e1 start + 0</span><br><span class="line">)</span><br><span class="line">libc++abi.dylib: terminate called throwing an exception</span><br></pre></td></tr></table></figure>
<p>移除NSAssert比较简单，我们需要在target中选择build settings, 找到 preprocessor macros(预处理宏）项目，配置它的release为 NS_BLOCK_ASSERTIONS。</p>
<p>具体操作步骤为： 双击release的空白处，此时会弹出对话框，点击对话框中的＋添加NS_BLOCK_ASSERTIONS。</p>
<h2 id="Xcode-的LLDB-调试"><a href="#Xcode-的LLDB-调试" class="headerlink" title="Xcode 的LLDB 调试"></a>Xcode 的LLDB 调试</h2><p>先说一下Xcode怎样添加断点，以及调试区域在哪里，话不多说，请看图：</p>
<p><img src="http://img1.ph.126.net/jQSUUWx67soejYnPYeTipg==/4855443348360538462.jpg" alt=""></p>
<p>当代码走到断点处，会进入调试模式，在Xcode右下方的调试区域，有 (lldb) 显示。</p>
<h3 id="常用-lldb-命令"><a href="#常用-lldb-命令" class="headerlink" title="常用 lldb 命令"></a>常用 lldb 命令</h3><ul>
<li>po 或 p 命令</li>
</ul>
<p>调试器中最常用到的命令是 p （用于输出基本类型）或者 po （用于输出 Objective-C 对象），示例如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 调试命令</span><br><span class="line">po username</span><br><span class="line"></span><br><span class="line">// 运行结果</span><br><span class="line">admin</span><br><span class="line"></span><br><span class="line">// 调试命令</span><br><span class="line">p username</span><br><span class="line"></span><br><span class="line">// 运行结果</span><br><span class="line">(__NSCFConstantString *) <span class="variable">$1</span> = 0x000000010c0f32a0 @<span class="string">"admin"</span></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">1. 每次查询的结果会保存在一些持续变量中($[0-9]+)，这样你可以在后面的查询中直接使用这些值。比如现在我接下来要重新取回 <span class="variable">$1</span> 的值：p <span class="variable">$1</span> </span><br><span class="line">运行结果：(__NSCFConstantString *) <span class="variable">$1</span> = 0x000000010c0f32a0 @<span class="string">"admin"</span></span><br><span class="line"></span><br><span class="line">2. 0x000000010c0f32a0 是username 的地址</span><br><span class="line">**/</span><br></pre></td></tr></table></figure>
<p>po 或 p 命令远没你想的那么简单，他还有执行代码的功能，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 执行命令</span><br><span class="line"> po [self.view <span class="built_in">set</span>BackgroundColor:[UIColor redColor]]</span><br><span class="line"></span><br><span class="line">然后你就发现当前视图的背景变成红色了。</span><br></pre></td></tr></table></figure>
<ul>
<li>expression 或 expr 命令</li>
</ul>
<p>常用于在调试过程中修改变量的值，而不用重新启动程序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 执行命令</span><br><span class="line">expression username = @<span class="string">"hello"</span></span><br><span class="line"></span><br><span class="line">// 执行结果</span><br><span class="line">(NSTaggedPointerString *) <span class="variable">$0</span> = 0xa00006f6c6c65685 @<span class="string">"hello"</span></span><br><span class="line"></span><br><span class="line">// 执行命令</span><br><span class="line">po username</span><br><span class="line"></span><br><span class="line">// 执行结果</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<p>除了上面的用途，还可以新声明一个变量，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 执行命令</span><br><span class="line">expression NSString * <span class="variable">$a</span> = @<span class="string">"xxxx"</span>   // $符号不要丢了</span><br><span class="line"></span><br><span class="line">// 执行命令</span><br><span class="line">po <span class="variable">$a</span></span><br><span class="line"></span><br><span class="line">// 执行结果</span><br><span class="line">xxxx</span><br></pre></td></tr></table></figure>
<ul>
<li>call 命令</li>
</ul>
<p>call 命令和 po 命令的功能相似，有的地方说“在不需要显示输出，或是方法无返回值时使用call”，但是使用 po 命令系统会向编代码一样提示你方法名或变量名，但是 call 命令不会啊，没想出有什么理由放弃 po 而使用 call 。</p>
<ul>
<li>bt 命令</li>
</ul>
<p>bt 命令用来打印主线程的堆栈信息，bt all 可以打印所有线程的堆栈信息。</p>
<ul>
<li>image 命令</li>
</ul>
<p>image 命令可用于寻址，有多个组合命令。比较实用的用法是用于寻找栈地址对应的代码位置。</p>
<p>比如以下代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSArray *array = @[@<span class="string">"1"</span>,@<span class="string">"2"</span>];</span><br><span class="line">NSLog(@<span class="string">"%@"</span>,array[3]);</span><br></pre></td></tr></table></figure>
<p>这段代码会报数组越界的错误，错误信息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">*** Terminating app due to uncaught exception <span class="string">'NSRangeException'</span>, reason: <span class="string">'*** -[__NSArrayI objectAtIndex:]: index 3 beyond bounds [0 .. 1]'</span></span><br><span class="line">*** First throw call stack:</span><br><span class="line">(</span><br><span class="line">	0   CoreFoundation                      0x0000000107d49d85 __exceptionPreprocess + 165</span><br><span class="line">	1   libobjc.A.dylib                     0x00000001077bddeb objc_exception_throw + 48</span><br><span class="line">	2   CoreFoundation                      0x0000000107c32934 -[__NSArrayI objectAtIndex:] + 164</span><br><span class="line">	3   demo                                0x00000001072b51f6 -[ViewController viewDidLoad] + 390</span><br><span class="line">	4   UIKit                               0x000000010829a984 -[UIViewController loadViewIfRequired] + 1198</span><br><span class="line">	5   UIKit                               0x000000010829acd3 -[UIViewController view] + 27</span><br><span class="line">	6   UIKit                               0x0000000108170fb4 -[UIWindow addRootViewControllerViewIfPossible] + 61</span><br><span class="line">	7   UIKit                               0x000000010817169d -[UIWindow _<span class="built_in">set</span>Hidden:forced:] + 282</span><br><span class="line">	8   UIKit                               0x0000000108183180 -[UIWindow makeKeyAndVisible] + 42</span><br><span class="line">	9   UIKit                               0x00000001080f7ed9 -[UIApplication _callInitializationDelegatesForMainScene:transitionContext:] + 4131</span><br><span class="line">	10  UIKit                               0x00000001080fe568 -[UIApplication _runWithMainScene:transitionContext:completion:] + 1769</span><br><span class="line">	11  UIKit                               0x00000001080fb714 -[UIApplication workspaceDidEndTransaction:] + 188</span><br><span class="line">	12  FrontBoardServices                  0x000000010ab688c8 __FBSSERIALQUEUE_IS_CALLING_OUT_TO_A_BLOCK__ + 24</span><br><span class="line">	13  FrontBoardServices                  0x000000010ab68741 -[FBSSerialQueue _performNext] + 178</span><br><span class="line">	14  FrontBoardServices                  0x000000010ab68aca -[FBSSerialQueue _performNextFromRunLoopSource] + 45</span><br><span class="line">	15  CoreFoundation                      0x0000000107c6f301 __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 17</span><br><span class="line">	16  CoreFoundation                      0x0000000107c6522c __CFRunLoopDoSources0 + 556</span><br><span class="line">	17  CoreFoundation                      0x0000000107c646e3 __CFRunLoopRun + 867</span><br><span class="line">	18  CoreFoundation                      0x0000000107c640f8 CFRunLoopRunSpecific + 488</span><br><span class="line">	19  UIKit                               0x00000001080faf21 -[UIApplication _run] + 402</span><br><span class="line">	20  UIKit                               0x00000001080fff09 UIApplicationMain + 171</span><br><span class="line">	21  demo                                0x00000001072b5bdf main + 111</span><br><span class="line">	22  libdyld.dylib                       0x000000010a52392d start + 1</span><br><span class="line">)</span><br><span class="line">libc++abi.dylib: terminating with uncaught exception of <span class="built_in">type</span> NSException</span><br><span class="line">(lldb)</span><br></pre></td></tr></table></figure>
<p>可能出错的地址是0x00000001072b51f6（可以根据执行文件名判断，或者最小的栈地址）。为了进一步精确定位，我们可以输入以下的命令： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 执行命令</span><br><span class="line">image lookup --address 0x00000001072b51f6</span><br><span class="line"></span><br><span class="line">// 运行结果</span><br><span class="line">Address: demo[0x00000001000011f6] (demo.__TEXT.__text + 390)</span><br><span class="line">Summary: demo`-[ViewController viewDidLoad] + 390 at ViewController.m:31</span><br><span class="line">  </span><br><span class="line">告诉我们出错位置是 ViewController.m 类的 31 行。</span><br></pre></td></tr></table></figure>
<ul>
<li>简称和别名</li>
</ul>
<p>有些调试命令比较长，使用起来比较麻烦，我们可以自定义别名。比如给image lookup –address 添加了一个 ila 的别名。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 执行命令</span><br><span class="line"><span class="built_in">command</span> <span class="built_in">alias</span> ila image lookup --address %1</span><br><span class="line"></span><br><span class="line">// 执行命令</span><br><span class="line">ila 0x00000001072b51f6</span><br><span class="line"></span><br><span class="line">// 运行结果</span><br><span class="line">Address: demo[0x00000001000011f6] (demo.__TEXT.__text + 390)</span><br><span class="line">Summary: demo`-[ViewController viewDidLoad] + 390 at ViewController.m:31</span><br></pre></td></tr></table></figure>
<p>等等，还没有结束，还有一个非常重要的命令 help，如果你对expr 命令不了解，可以使用help expr 来查看更多关于expr 命令的信息。</p>
<h3 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h3><p>请看图：</p>
<p><img src="http://img2.ph.126.net/vIalJWfbjDn_u8-cDQ0fAQ==/6631707681466260683.jpg" alt=""></p>
<p>双击断点，选择编辑选项，开始编辑断点。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Condition：此处是判断断点的执行条件，当(BOOL)[username isEqualToString:@<span class="string">"admin"</span>]为 YES 时，执行断点。</span><br><span class="line"></span><br><span class="line">Action：此处是执行的调试命令，比如 expr username = @<span class="string">"hello"</span> 等改变变量值的命令，或者格式化输出 po [NSString stringWithFormat:@<span class="string">"username:%@ \npassword:%@"</span>,username,password]，当然还可以执行其他命令。</span><br><span class="line"></span><br><span class="line">Options：此处勾选，断点处不会进入调试模式。</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>调试方法的灵活使用，可以减轻开发负担，同时也能更加准确的找到问题所在。这里只是平时常用的几个命令，想要更多的命令，还需要自己取学习。</p>
<p>参考网站  <a href="http://lldb.llvm.org/" target="_blank" rel="external">The LLDB Debugger</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/18/iOS Bug 汇总/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东折">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Try and try again！The worst result is failure!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/18/iOS Bug 汇总/" itemprop="url">iOS Bug 汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-18T18:08:56+08:00">
                2016-05-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/18/iOS Bug 汇总/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/18/iOS Bug 汇总/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>1. objc[xxxx]: Cannot form weak reference to instance (xxxx) of class xxxx. It is possible that this object was over-released, or is in the process of deallocation.</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">解决方案：</span><br><span class="line"></span><br><span class="line">1. 不要在 dealloc 方法中，使用 weak self</span><br><span class="line"></span><br><span class="line">2. A控制器(包含scrollView及其子类，并设置了其代理)，B控制器(webView，并设置了webView.scrollView.delegate = self)，当A push 到 B，然后B pop回 A时，会引起程序崩溃。解决方案就是再B将要退出时把webView.scrollView.delegate = nil。</span><br></pre></td></tr></table></figure>
<p><strong>2. object file was built for newer iOS version (8.1) than being linked (7.0)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">解决方案：</span><br><span class="line"></span><br><span class="line">1. 查看是否在导入.h文件时，误导入了.m文件。</span><br><span class="line"></span><br><span class="line">2. 在Build Settings -&gt; other lingkr Flags 中添加 -w</span><br></pre></td></tr></table></figure>
<p><strong>3. The operation couldn’t be completed. (LaunchServicesError error 0.)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">解决办法：</span><br><span class="line">第1种方法.点击当前的模拟器，点击IOS Simulator-&gt;Reset Content and Settings...-&gt;Reset，然后会重置模拟器，再编译代码可登录模拟器成功</span><br><span class="line">第2种方法.点击Xcode-&gt;Product-&gt;Clean</span><br><span class="line">第3种方法.将模拟器上的当前运行的app删除，再重新加载(长按模拟器的屏幕，点击当前报错的app 删除)</span><br><span class="line">第4种方法.在info.plist文件中修改bundle的版本号</span><br></pre></td></tr></table></figure>
<p><strong>4. Could not find Developer Disk Image</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">是由于Xcode支持的最高版本低于真机的系统版本，才会导致此类问题发生。</span><br><span class="line">解决方案一：升级xcode到最新版本</span><br><span class="line">解决方案二：添加 真机系统版本的资源包，到路径/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/DeviceSupport 中</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/18/iOS时间格式转换总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东折">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Try and try again！The worst result is failure!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/18/iOS时间格式转换总结/" itemprop="url">iOS时间格式转换总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-18T10:22:11+08:00">
                2016-05-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/18/iOS时间格式转换总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/18/iOS时间格式转换总结/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在iOS程序开发中，有时需要将时间转换成我们需要的格式。如果服务器返回的时间格式是时间戳，转换起来相对比较简单；但是如果给的不是时间戳转换起来可能稍微麻烦一点。返回的什么格式可以协商，返回的时间的样式要统一，不要这里返回时间戳，那里返回标准时间。</p>
<h2 id="UTC、GMT和时间戳简介"><a href="#UTC、GMT和时间戳简介" class="headerlink" title="UTC、GMT和时间戳简介"></a>UTC、GMT和时间戳简介</h2><h3 id="GMT"><a href="#GMT" class="headerlink" title="GMT"></a>GMT</h3><p>格林尼治标准时间（Greenwich Mean Time，GMT）是指位于英国伦敦郊区的皇家格林尼治天文台的标准时间，即本初子午线时间。</p>
<p>由于地球在它的椭圆轨道里的运动速度不均匀，这个时刻可能与实际的太阳时有误差，最大误差达16分钟。</p>
<p>地球每天的自转是有些不规则的，而且正在缓慢减速，因此格林尼治时间已经不再被作为标准时间使用。</p>
<h3 id="UTC"><a href="#UTC" class="headerlink" title="UTC"></a>UTC</h3><p>协调世界时间（又称世界标准时间），与 GMT 一样都是本初子午线时间，只不过 UTC 是经过协调后的世界时间，比 GMT 更加准确。</p>
<p>全球共有二十四个时区，格林尼治时间指本初子午线时间（东经和西经交界处），北京位于东八区。</p>
<p>时区差东为正，西为负。因此，把东八区时区差记为 +0800。</p>
<h3 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h3><p>时间戳是指格林尼治时间1970年01月01日00时00分00秒(北京时间1970年01月01日08时00分00秒)起至现在的总秒数。</p>
<h2 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h2><h3 id="时间处理类简介"><a href="#时间处理类简介" class="headerlink" title="时间处理类简介"></a>时间处理类简介</h3><p> NSDate</p>
<p> 用于描述一个特定的时间点，可以获取时间，但没法单独获取年，月，日等信息。 提供方法来获得时间（过去，当前，未来都可以），计算两个时间之间的间隔，比较时间，描述时间内容。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 获取当前时间</span><br><span class="line">NSDate *date = [NSDate date];</span><br></pre></td></tr></table></figure>
<p> NSDateFormatter</p>
<p> 用于描述 <code>date</code> 的显示格式，配合 NSDate 使用。可以设置时间显示格式，日期格式，时间格式，还有时区等等，最方便的是，你还可以设置AM/PM，月份，星期的显示内容。</p>
<p> NSDateComponents</p>
<p> 可以得到我们比较熟悉的年月日时分秒信息，在一些计算显示场合很有用处，用NSDate类是无法单独来获得每一个元素信息的，必须使用这个NSDateComponents类。</p>
<p> NSCalendar</p>
<p>用来描述一种特定的日历。同时还提供了大部分基于时间计算的接口，并且把NSDate类和NSDateComponents类联系了起来。</p>
<h3 id="字符说明"><a href="#字符说明" class="headerlink" title="字符说明"></a>字符说明</h3><p>(:)</p>
<p>时间分隔符。在某些区域设置中，可以使用其他字符表示时间分隔符。时间分隔符在格式化时间值时分隔小时、分钟和秒。格式化输出中用作时间分隔符的实际字符由您的应用程序的当前区域性值确定。</p>
<p>(/)</p>
<p>日期分隔符。在某些区域设置中，可以使用其他字符表示日期分隔符。日期分隔符在格式化日期值时分隔日、月和年。格式化输出中用作日期分隔符的实际字符由您的应用程序的当前区域性确定。</p>
<p>(%)</p>
<p>用于表明不论尾随什么字母，随后字符都应该以单字母格式读取。也用于表明单字母格式应以用户定义格式读取。有关更多详细信息，请参见下面的内容。</p>
<p>d</p>
<p>将日显示为不带前导零的数字（如 1）。如果这是用户定义的数字格式中的唯一字符，请使用 %d。</p>
<p>dd</p>
<p>将日显示为带前导零的数字（如 01）。</p>
<p>EEE</p>
<p>将日显示为缩写形式（例如 Sun）。</p>
<p>EEEE</p>
<p>将日显示为全名（例如 Sunday）。</p>
<p>M</p>
<p>将月份显示为不带前导零的数字（如一月表示为 1）。如果这是用户定义的数字格式中的唯一字符，请使用 %M。</p>
<p>MM</p>
<p>将月份显示为带前导零的数字（例如 01/12/01）。</p>
<p>MMM</p>
<p>将月份显示为缩写形式（例如 Jan）。</p>
<p>MMMM</p>
<p>将月份显示为完整月份名（例如 January）。</p>
<p>gg</p>
<p>显示时代/纪元字符串（例如 A.D.）</p>
<p>h</p>
<p>使用 12 小时制将小时显示为不带前导零的数字（例如 1:15:15 PM）。如果这是用户定义的数字格式中的唯一字符，请使用 %h。</p>
<p>hh</p>
<p>使用 12 小时制将小时显示为带前导零的数字（例如 01:15:15 PM）。</p>
<p>H</p>
<p>使用 24 小时制将小时显示为不带前导零的数字（例如 1:15:15）。如果这是用户定义的数字格式中的唯一字符，请使用 %H。</p>
<p>HH</p>
<p>使用 24 小时制将小时显示为带前导零的数字（例如 01:15:15）。</p>
<p>m</p>
<p>将分钟显示为不带前导零的数字（例如 12:1:15）。如果这是用户定义的数字格式中的唯一字符，请使用 %m。</p>
<p>mm</p>
<p>将分钟显示为带前导零的数字（例如 12:01:15）。</p>
<p>s</p>
<p>将秒显示为不带前导零的数字（例如 12:15:5）。如果这是用户定义的数字格式中的唯一字符，请使用 %s。</p>
<p>ss</p>
<p>将秒显示为带前导零的数字（例如 12:15:05）。</p>
<p>S（SS，SSS）</p>
<p>显示毫秒</p>
<p>aa（a）</p>
<p>对于使用 12 小时制的区域设置，对中午之前任一小时显示大写的 AM，对中午到 11:59 P.M 之间的任一小时显示大写的 PM。</p>
<p>对于使用 24 小时制的区域设置，不显示任何字符。</p>
<p>y</p>
<p>将年份 (0-9) 显示为不带前导零的数字。如果这是用户定义的数字格式中的唯一字符，请使用 %y。</p>
<p>yy</p>
<p>以带前导零的两位数字格式显示年份（如果适用）。</p>
<p>yyy</p>
<p>以四位数字格式显示年份。</p>
<p>yyyy</p>
<p>以四位数字格式显示年份。</p>
<p>z</p>
<p>显示不带前导零的时区偏移量（如 -8）。如果这是用户定义的数字格式中的唯一字符，请使用 %z。</p>
<p>zz</p>
<p>显示带前导零的时区偏移量（例如 -08）</p>
<p>zzz</p>
<p>显示完整的时区偏移量（例如 -08:00）</p>
<h3 id="格式显示"><a href="#格式显示" class="headerlink" title="格式显示"></a>格式显示</h3><p>M/d/yy —–&gt; 12/7/58</p>
<p>d-MMM —–&gt; 7-Dec</p>
<p>d-MMMM-yy —–&gt; 7-December-58</p>
<p>d MMMM —–&gt; 7 December</p>
<p>MMMM yy —–&gt; December 58</p>
<p>hh:mm tt —–&gt; 08:50 PM</p>
<p>h:mm:ss t —–&gt; 8:50:35 P</p>
<p>H:mm —–&gt; 20:50</p>
<p>H:mm:ss —–&gt; 20:50:35</p>
<p>M/d/yyyy H:mm —–&gt; 12/7/1958 20:50</p>
<p>yyyy-MM-dd HH:mm:ss.SSS —–&gt; 2014-09-10 09:12:10.000</p>
<p>yyyy-MM-dd HH:mm:ss —–&gt;  2014-09-10 09:12:10</p>
<p>yyyy-MM-dd —–&gt;  2014-09-10 </p>
<p>MM dd yyyy —–&gt; 09 10 2014</p>
<p>EEE, yyyy-MM-dd HH:mm:ss —–&gt; Tue 2014-09-10 09:12:10</p>
<h3 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">// 获取当前时间</span><br><span class="line">NSDate *date = [NSDate date];</span><br><span class="line"></span><br><span class="line">// 根据时间戳获取时间</span><br><span class="line">NSDate *date = [NSDate dateWithTimeIntervalSince1970:timeInterval];</span><br><span class="line"></span><br><span class="line">// 距离当前时间 timeInterval 秒的时间</span><br><span class="line">NSDate *date = [NSDate dateWithTimeIntervalSinceNow:timeInterval];</span><br><span class="line"></span><br><span class="line">// 将 Jul 22, 2014 9:00:00 AM 格式的时间转换成时间戳</span><br><span class="line">NSString *time = @<span class="string">"Jul 22, 2014 9:00:00 AM"</span>;</span><br><span class="line">NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>DateFormat:@<span class="string">"MMM dd, yyyy hh:mm:ss aa"</span>];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>Locale:[[NSLocale alloc] initWithLocaleIdentifier:@<span class="string">"en_US_POSIX"</span>]];</span><br><span class="line">// 使用系统默认的会有8个小时的时差</span><br><span class="line">// [dateFormatter <span class="built_in">set</span>TimeZone:[NSTimeZone systemTimeZone]];</span><br><span class="line">// 使用这种方式也可以</span><br><span class="line">// [dateFormatter <span class="built_in">set</span>TimeZone:[NSTimeZone timeZoneForSecondsFromGMT:8]];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>TimeZone:[NSTimeZone timeZoneWithName:@<span class="string">"UTC"</span>]]; // 或GMT</span><br><span class="line">NSDate *date = [dateFormatter dateFromString:time]; </span><br><span class="line">NSLog(@<span class="string">"date:%@"</span>,date);</span><br><span class="line">NSTimeInterval timeInterval = [date timeIntervalSince1970];</span><br><span class="line">NSLog(@<span class="string">"%f"</span>,timeInterval);</span><br><span class="line"></span><br><span class="line">// 将20110826134106转换成特定的时间字符串</span><br><span class="line">NSString *time = @<span class="string">"20110826134106"</span>;</span><br><span class="line">NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>DateFormat:@<span class="string">"yyyyMMddHHmmss"</span>];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>Locale:[[NSLocale alloc] initWithLocaleIdentifier:@<span class="string">"en_US_POSIX"</span>]];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>TimeZone:[NSTimeZone timeZoneWithName:@<span class="string">"GMT"</span>]];</span><br><span class="line">NSDate *date = [dateFormatter dateFromString:time];</span><br><span class="line">NSLog(@<span class="string">"date:%@"</span>,date);    </span><br><span class="line">[dateFormatter <span class="built_in">set</span>DateFormat:@<span class="string">"EEE, yyyy-MM-dd HH:mm:ss"</span>]; </span><br><span class="line">NSString *string = [dateFormatter stringFromDate:date];</span><br><span class="line">NSLog(@<span class="string">"string:%@"</span>,string);</span><br><span class="line"></span><br><span class="line">// 将Wed, 05 May 2011 10:50:00 +0800转换成特定的时间字符串</span><br><span class="line"> NSString *time = @<span class="string">"Wed, 05 May 2011 10:50:00 +0800"</span>;</span><br><span class="line"> NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>DateFormat:@<span class="string">"EEE, dd MM yyyy HH:mm:ss ZZZ"</span>];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>Locale:[[NSLocale alloc] initWithLocaleIdentifier:@<span class="string">"en_US_POSIX"</span>]];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>TimeZone:[NSTimeZone systemTimeZone]];</span><br><span class="line">NSDate *date = [dateFormatter dateFromString:time];   </span><br><span class="line">NSLog(@<span class="string">"date:%@"</span>,date);    </span><br><span class="line">[dateFormatter <span class="built_in">set</span>DateFormat:@<span class="string">"EEE, yyyy-MM-dd HH:mm:ss"</span>];</span><br><span class="line">NSString *string = [dateFormatter stringFromDate:date]; </span><br><span class="line">NSLog(@<span class="string">"string:%@"</span>,string);</span><br><span class="line"></span><br><span class="line">// 获取年、月、日、星期等</span><br><span class="line">NSString *time = @<span class="string">"2016-06-01 11:00:00"</span>;</span><br><span class="line">NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>DateFormat:@<span class="string">"yyyy-MM-dd HH:mm:ss"</span>];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>Locale:[[NSLocale alloc] initWithLocaleIdentifier:@<span class="string">"en_US_POSIX"</span>]];</span><br><span class="line">[dateFormatter <span class="built_in">set</span>TimeZone:[NSTimeZone timeZoneWithName:@<span class="string">"GMT"</span>]];</span><br><span class="line">NSDate *date = [dateFormatter dateFromString:time];</span><br><span class="line">NSCalendar *calendar = [[NSCalendar alloc] initWithCalendarIdentifier:NSGregorianCalendar];</span><br><span class="line">NSDateComponents *comps = [[NSDateComponents alloc] init];</span><br><span class="line">NSInteger unitFlags = NSYearCalendarUnit |NSMonthCalendarUnit |NSDayCalendarUnit |NSWeekdayCalendarUnit |NSHourCalendarUnit |NSMinuteCalendarUnit |NSSecondCalendarUnit;</span><br><span class="line">comps = [calendar components:unitFlags fromDate:date];</span><br><span class="line">NSInteger week = [comps weekday];</span><br><span class="line">NSInteger year = [comps year];</span><br><span class="line">NSInteger month = [comps month];</span><br><span class="line">NSInteger day = [comps day];</span><br><span class="line"></span><br><span class="line">// 判断日期是否在本周内</span><br><span class="line">-(BOOL)isDateThisWeek:(NSDate *)date &#123;</span><br><span class="line">    </span><br><span class="line">    NSDate *start;</span><br><span class="line">    NSTimeInterval extends;</span><br><span class="line">    </span><br><span class="line">    NSCalendar *cal=[NSCalendar autoupdatingCurrentCalendar];</span><br><span class="line">    NSDate *today=[NSDate date];</span><br><span class="line">    </span><br><span class="line">    BOOL success= [cal rangeOfUnit:NSWeekCalendarUnit startDate:&amp;start interval: &amp;extends <span class="keyword">for</span>Date:today];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!success)</span><br><span class="line">        <span class="built_in">return</span> NO;</span><br><span class="line">    </span><br><span class="line">    NSTimeInterval dateInSecs = [date timeIntervalSinceReferenceDate];</span><br><span class="line">    NSTimeInterval dayStartInSecs= [start timeIntervalSinceReferenceDate];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(dateInSecs &gt; dayStartInSecs &amp;&amp; dateInSecs &lt; (dayStartInSecs+extends))&#123;</span><br><span class="line">        <span class="built_in">return</span> YES;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">return</span> NO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">比较两个日期相差多少时，一般使用时间戳进行比较。（如果你有更好的方法，欢迎分享一下）</span><br><span class="line"></span><br><span class="line">NSDateFormatter创建比较慢，最好使用单例。</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/13/iOS 开发中一些实用小代码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东折">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Try and try again！The worst result is failure!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/13/iOS 开发中一些实用小代码/" itemprop="url">iOS 开发中一些实用小代码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-13T00:00:00+08:00">
                2016-05-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/13/iOS 开发中一些实用小代码/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/iOS 开发中一些实用小代码/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文介绍了 iOS 实际开发过程中的一些实用代码段。 </p>
<h2 id="代码段"><a href="#代码段" class="headerlink" title="代码段"></a>代码段</h2><h3 id="添加-pch-文件"><a href="#添加-pch-文件" class="headerlink" title="添加 pch 文件"></a>添加 pch 文件</h3><p>pre-Compile Header（预编译头文件），一般存放一些使用频率较高的代码或文件。尽量不要存放太多内容，如果预编译的代码太多的话，会增加程序的启动时间。</p>
<p>Command + N 打开新建文件窗口，选择 iOS –&gt; Other –&gt; PCH File 创建 pch 文件，如图：</p>
<p><img src="http://img1.ph.126.net/TWHKIs7KOKEVYrH0OUN6RA==/4900479344633179915.jpg" alt=""></p>
<p>点击 <code>Next</code></p>
<p><img src="http://img0.ph.126.net/zmtb-Jx9rg0IPZhKeOMFBQ==/6598164880299623877.png" alt=""></p>
<p>点击 <code>Create</code></p>
<p>PCH 文件创建好之后需要配置一下，如图：</p>
<p><img src="http://img0.ph.126.net/z6EzTBPi-Eb8_1SolLq7IQ==/1623829140745544649.jpg" alt=""></p>
<p>将图片中的 <code>Precompile Prefix Header</code> 右边的NO改为Yes。预编译后的pch文件会被缓存起来，可以提高编译速度。</p>
<p>同时编辑 <code>Prefix Header</code> ，如图：</p>
<p><img src="http://img1.ph.126.net/9L6HSoGb2bNFQuVtxmmcQA==/4872331846962121723.jpg" alt=""></p>
<p>这是相对路径的写法，<code>pch</code>指的是项目名，<code>pch.pch</code>指的是项目中pch文件的文件名和后缀。</p>
<p>到这里 PCH 文件已经创建并配置完成，最后一步是把需要预编译的代码放到 <code>pch.pch</code> 中，如图：</p>
<p><img src="http://img0.ph.126.net/Jee22sslSfqPm6sSag5y6g==/4849532373849192267.jpg" alt=""></p>
<p>这里我设置了两个宏定义(屏幕宽和屏幕高)并引入了一个<code>Common.h</code>的头文件。</p>
<p>然后你就发现 kSCREEN_WIDTH 和 kSCREEN_HEIGHT 变成全局的了。</p>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// 验证邮箱</span><br><span class="line">+ (BOOL)validateEmail:(NSString *)email</span><br><span class="line">&#123;</span><br><span class="line">    NSString *pattern = @<span class="string">"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]&#123;2,4&#125;"</span>;</span><br><span class="line">    NSPredicate *pred = [NSPredicate predicateWithFormat:@<span class="string">"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    BOOL isMatch = [pred evaluateWithObject:email];</span><br><span class="line">    <span class="built_in">return</span> isMatch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 验证手机号</span><br><span class="line">+ (BOOL)validateMobile:(NSString *)mobile</span><br><span class="line">&#123;</span><br><span class="line">    // 以1开头，第二位是3，5，7，8的11位整数</span><br><span class="line">    NSString *pattern = @<span class="string">"^1[3578]\\d&#123;9&#125;$"</span>;</span><br><span class="line">    NSPredicate *pred = [NSPredicate predicateWithFormat:@<span class="string">"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    BOOL isMatch = [pred evaluateWithObject:mobile];</span><br><span class="line">    <span class="built_in">return</span> isMatch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 验证用户名</span><br><span class="line">+ (BOOL)validateNickName:(NSString *)userName</span><br><span class="line">&#123;</span><br><span class="line">    //2-10个中英文、数字和下划线</span><br><span class="line">    //NSString *pattern = @<span class="string">"[\u4e00-\u9fa5_a-zA-Z0-9]&#123;2,10&#125;"</span>;</span><br><span class="line">    //  \S匹配任意可见字符</span><br><span class="line">    NSString *pattern = @<span class="string">"\\S&#123;0,10&#125;"</span>;</span><br><span class="line">    NSPredicate *pred = [NSPredicate predicateWithFormat:@<span class="string">"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    BOOL isMatch = [pred evaluateWithObject:userName];</span><br><span class="line">    <span class="built_in">return</span> isMatch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 验证密码</span><br><span class="line">+ (BOOL)validatePassword:(NSString *)password</span><br><span class="line">&#123;</span><br><span class="line">    //6-20位的数字字母组合-- ^表示已...开头，$表示已...结尾</span><br><span class="line">    NSString *pattern = @<span class="string">"^[a-zA-Z0-9]&#123;6,18&#125;+$"</span>;</span><br><span class="line">    NSPredicate *pred = [NSPredicate predicateWithFormat:@<span class="string">"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    BOOL isMatch = [pred evaluateWithObject:password];</span><br><span class="line">    <span class="built_in">return</span> isMatch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考网站：<a href="http://blog.csdn.net/chaoyuan899/article/details/38583759" target="_blank" rel="external">IOS常用正则表达式 </a></p>
<h3 id="点击状态栏不返回顶部问题"><a href="#点击状态栏不返回顶部问题" class="headerlink" title="点击状态栏不返回顶部问题"></a>点击状态栏不返回顶部问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property(nonatomic) BOOL  scrollsToTop __TVOS_PROHIBITED;          // default is YES.</span><br></pre></td></tr></table></figure>
<p>官方文档说：当一个控制器只有一个 scrollView 或 scrollView 的子类（tableView，collectionView等），并且把这个属性设置为 YES，点击状态栏才能回到顶部；当有2个或以上的scrollView，系统不知道你需要操作的是那个scrollView，因此需要将其他的scrollView的这个属性设置为 NO。</p>
<h3 id="导航栏和状态栏"><a href="#导航栏和状态栏" class="headerlink" title="导航栏和状态栏"></a>导航栏和状态栏</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 隐藏导航栏</span><br><span class="line">[self.navigationController <span class="built_in">set</span>NavigationBarHidden:YES animated:YES];</span><br><span class="line"></span><br><span class="line">// 隐藏状态栏</span><br><span class="line">[[UIApplication sharedApplication] <span class="built_in">set</span>StatusBarHidden:YES];</span><br><span class="line"></span><br><span class="line">// 设置导航栏是否半透明</span><br><span class="line">self.navigationController.navigationBar.translucent = YES;</span><br><span class="line"></span><br><span class="line">// 导航栏变为透明</span><br><span class="line">[self.navigationController.navigationBar <span class="built_in">set</span>BackgroundImage:[UIImage new] <span class="keyword">for</span>BarMetrics:0];</span><br><span class="line">// 让黑线消失的方法</span><br><span class="line">self.navigationController.navigationBar.shadowImage=[UIImage new];</span><br><span class="line"></span><br><span class="line">// 状态栏的网络活动风火轮是否旋转</span><br><span class="line">[UIApplication sharedApplication].networkActivityIndicatorVisible = YES ; //默认值是NO。</span><br></pre></td></tr></table></figure>
<h3 id="for循环和while循环"><a href="#for循环和while循环" class="headerlink" title="for循环和while循环"></a>for循环和while循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span> (NSString *str <span class="keyword">in</span> array) &#123;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 先执行i = 0（只执行一次）；再执行循环体，最后执行i++；</span><br><span class="line"><span class="keyword">for</span> (int i=0; i&lt;10; i++) &#123;</span><br><span class="line">// 循环体</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 等同于<span class="keyword">for</span>循环</span><br><span class="line">// 当循环到结尾然后需要从头再次循环时使用，<span class="keyword">for</span>循环不可以。</span><br><span class="line">int i = 0;</span><br><span class="line"><span class="keyword">while</span> (i &lt; 10) &#123;  </span><br><span class="line">    <span class="keyword">if</span>(i == 9)</span><br><span class="line">    &#123;</span><br><span class="line">         i = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    NSLog(@<span class="string">"i: %d"</span>, i);  </span><br><span class="line">    i ++;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="截取屏幕图片"><a href="#截取屏幕图片" class="headerlink" title="截取屏幕图片"></a>截取屏幕图片</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//创建一个基于位图的图形上下文并指定大小为CGSizeMake(200,400) </span><br><span class="line">UIGraphicsBeginImageContext(CGSizeMake(200,400)); </span><br><span class="line"> </span><br><span class="line">//renderInContext 呈现接受者及其子范围到指定的上下文 </span><br><span class="line">//self.view.layer 表示要截屏的视图</span><br><span class="line">[self.view.layer renderInContext:UIGraphicsGetCurrentContext()]; </span><br><span class="line"></span><br><span class="line">//返回一个基于当前图形上下文的图片 </span><br><span class="line">UIImage *aImage = UIGraphicsGetImageFromCurrentImageContext(); </span><br><span class="line"></span><br><span class="line">//移除栈顶的基于当前位图的图形上下文 </span><br><span class="line">UIGraphicsEndImageContext(); </span><br><span class="line"></span><br><span class="line">//以png格式返回指定图片的数据 </span><br><span class="line">imageData = UIImagePNGRepresentation(aImage);</span><br></pre></td></tr></table></figure>
<h3 id="图片压缩"><a href="#图片压缩" class="headerlink" title="图片压缩"></a>图片压缩</h3><p>方案一：文件体积变小，但是像素没变，长宽尺寸不变，可能导致图片质量下降，并且有一个压缩最小值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSData *data=UIImageJPEGRepresentation(image, 0.0f);</span><br></pre></td></tr></table></figure>
<p>方案二：裁剪图片，图片像素数减少，长宽尺寸减小，图片体积也减少</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (NSData *)imageWithImage:(UIImage*)image</span><br><span class="line">          scaledToSize:(CGSize)newSize;</span><br><span class="line">&#123;</span><br><span class="line">    UIGraphicsBeginImageContext(newSize);</span><br><span class="line">    [image drawInRect:CGRectMake(0,0,newSize.width,newSize.height)];</span><br><span class="line">    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();</span><br><span class="line">    UIGraphicsEndImageContext();</span><br><span class="line">    // 有时需要两种方案配合使用</span><br><span class="line">    <span class="built_in">return</span> UIImageJPEGRepresentation(newImage, 0.8);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="上传图片"><a href="#上传图片" class="headerlink" title="上传图片"></a>上传图片</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</span><br><span class="line">[manager POST:url parameters:parameters constructingBodyWithBlock:^(id&lt;AFMultipartFormData&gt; formData) &#123;</span><br><span class="line">    </span><br><span class="line">    NSData *imgData = UIImageJPEGRepresentation(image, 0.5);</span><br><span class="line">    /**</span><br><span class="line">     *  name：部分是服务器用来解析的字段</span><br><span class="line">     *  fileName：则是直接上传上去的图片，注意一定要加 .jpg或者.png，（这个根据你得到这个imgData是通过jepg还是png的方式来获取决定）。</span><br><span class="line">     *  mimeType：值也要与上面的类型对应，网上看到有的说直接写成 @<span class="string">"image/*"</span>， 据说也是可以的， 没验证过。</span><br><span class="line">     */</span><br><span class="line">    [formData appendPartWithFileData:imgData name:@<span class="string">"avatar"</span> fileName:@<span class="string">"avatar.jpg"</span> mimeType:@<span class="string">"image/jpeg"</span>];</span><br><span class="line">    </span><br><span class="line">&#125; success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</span><br><span class="line">    </span><br><span class="line">&#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="UITableViewWrapperView-和UITableView-的-frame-不同"><a href="#UITableViewWrapperView-和UITableView-的-frame-不同" class="headerlink" title="UITableViewWrapperView 和UITableView 的 frame 不同"></a>UITableViewWrapperView 和UITableView 的 frame 不同</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">解决方案</span><br><span class="line"> - (void)viewWillLayoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [super viewWillLayoutSubviews];</span><br><span class="line">    </span><br><span class="line">    self.tableView.contentInset = UIEdgeInsetsZero;</span><br><span class="line">    self.tableView.scrollIndicatorInsets = UIEdgeInsetsZero;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="iOS-自定义TextView-TextField光标颜色、长度或高度"><a href="#iOS-自定义TextView-TextField光标颜色、长度或高度" class="headerlink" title="iOS 自定义TextView/TextField光标颜色、长度或高度"></a>iOS 自定义TextView/TextField光标颜色、长度或高度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. TextView/TextField光标颜色可通过设置tintColor属性进行修改:</span><br><span class="line"></span><br><span class="line">self.textView.tintColor = [UIColor redColor];</span><br><span class="line"></span><br><span class="line">2. TextView/TextField自定义光标长度或高度, 可通过重写父类方法caretRectForPosition:实现, 具体设置如下:</span><br><span class="line"></span><br><span class="line">@interface CustomTextView : UITextView</span><br><span class="line"></span><br><span class="line">重写父类方法: </span><br><span class="line"></span><br><span class="line">- (CGRect)caretRectForPosition:(UITextPosition *)position</span><br><span class="line">&#123;</span><br><span class="line">    CGRect originalRect = [super caretRectForPosition:position];</span><br><span class="line">    originalRect.origin.x = 8;</span><br><span class="line">    originalRect.origin.y = 10;</span><br><span class="line">    originalRect.size.height = self.font.lineHeight;</span><br><span class="line">    originalRect.size.width = 1;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> originalRect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="输入框明文和密文切换问题"><a href="#输入框明文和密文切换问题" class="headerlink" title="输入框明文和密文切换问题"></a>输入框明文和密文切换问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1. 明文和密文切换末尾空白</span><br><span class="line"></span><br><span class="line">// 在转换方法中添加以下代码</span><br><span class="line">- (void)switchAction:(id)sender &#123;</span><br><span class="line">    self.passwordTextField.secureTextEntry = !self.passwordTextField.secureTextEntry;</span><br><span class="line">    NSString* text = self.passwordTextField.text;</span><br><span class="line">    self.passwordTextField.text = @<span class="string">" "</span>;</span><br><span class="line">    self.passwordTextField.text = text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2. 明文和密文切换再次输入会清空输入内容</span><br><span class="line"></span><br><span class="line">// 在代理方法中添加以下代码</span><br><span class="line"></span><br><span class="line">-(BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string&#123;</span><br><span class="line"></span><br><span class="line">    NSString * toBeString = [textField.text stringByReplacingCharactersInRange:range withString:string];</span><br><span class="line">    <span class="keyword">if</span> (textField == _passwordTF &amp;&amp; textField.isSecureTextEntry ) &#123;</span><br><span class="line">        textField.text = toBeString;</span><br><span class="line">        <span class="built_in">return</span> NO;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="shareSDK问题"><a href="#shareSDK问题" class="headerlink" title="shareSDK问题"></a>shareSDK问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//   新浪微博分享--解决does multipart has image?问题， <span class="string">"说明传的图片的地址新浪微博解析不出来，会失败，可能是你的图片的url（测试地址，内网），新浪访问不了，再就是将ip换成域名即可。"</span></span><br><span class="line">//  我解决的办法是：将设置参数方法的第三个参数image，由传链接的形式，改为直接用UIImage类型的对象</span><br><span class="line"></span><br><span class="line">NSData * image_data = [[NSData alloc]initWithContentsOfURL:[NSURL URLWithString:_imageUrl]];</span><br><span class="line">UIImage *sina_image = [UIImage imageWithData:image_data];</span><br><span class="line">id&lt;ISSCAttachment&gt;  _image = [ShareSDK pngImageWithImage:sina_image];</span><br><span class="line"></span><br><span class="line">// 第三方登录--QQ</span><br><span class="line">// 当客户端未安装时，不会调用网页版QQ。关于QZone网页授权：1，以前申请的应用可以网页授权，但现在新申请的网页应用不可以网页授权。2，ShareSDK之前因为用户反馈，有网页授权会通不过审核，所以不得已去掉了网页授权。</span><br></pre></td></tr></table></figure>
<h3 id="textView与textField限制输入字数问题"><a href="#textView与textField限制输入字数问题" class="headerlink" title="textView与textField限制输入字数问题"></a>textView与textField限制输入字数问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// 一般采用这个方法</span><br><span class="line">- (BOOL)textView:(UITextView *)textView shouldChangeTextInRange:(NSRange)range replacementText:(NSString *)text</span><br><span class="line">&#123;</span><br><span class="line">    //判断输入的字符，是否超过界限</span><br><span class="line">    NSString *str = [NSString stringWithFormat:@<span class="string">"%@%@"</span>, textView.text, text];</span><br><span class="line">    <span class="keyword">if</span> (str.length &gt; kMaxLen)</span><br><span class="line">    &#123;</span><br><span class="line">        textView.text = [str substringToIndex:kMaxLen];</span><br><span class="line">        <span class="built_in">return</span> NO;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> // 但是，在汉语拼音输入状态下，如果有键盘联想汉字输入，则无法回调到该函数，所以可以一直联想输入下去，做不到限制字符数量的目的，为了解决这个问题，我们在textViewDidChange进行限制。</span><br><span class="line"></span><br><span class="line">- (void)textViewDidChange:(UITextView *)textView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ( textView.text.length &gt; kMaxLen)</span><br><span class="line">    &#123;</span><br><span class="line">        textView.text = [textView.text substringToIndex:kMaxLen];</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">// 此时，如果在拼音状态下输入会有crash ,因为汉语拼音状态下，联想出的汉字等待用户选择，在用户选择前的状态下，不能改变textView.text。解决办法：</span><br><span class="line"></span><br><span class="line">- (void)textViewDidChange:(UITextView *)textView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (textView.markedTextRange == nil &amp;&amp; textView.text.length &gt; kMaxLen)  </span><br><span class="line">    //加上 textView.markedTextRange == nil判断，当此属性为nil时，代表不在这种联想输入等待确定状态。</span><br><span class="line">    &#123;</span><br><span class="line">        textView.text = [textView.text substringToIndex:kMaxLen];</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="修改tableView的分割线"><a href="#修改tableView的分割线" class="headerlink" title="修改tableView的分割线"></a>修改tableView的分割线</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span> ([tableView respondsToSelector:@selector (<span class="built_in">set</span>SeparatorInset:)]) &#123;</span><br><span class="line"></span><br><span class="line">        [tableView <span class="built_in">set</span>SeparatorInset:UIEdgeInsetsZero];</span><br><span class="line">        [tableView <span class="built_in">set</span>SeparatorColor:kGetColor ( 18.0 , 18.0 , 18.0 )];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="UITableView-的plain样式分组名悬浮问题"><a href="#UITableView-的plain样式分组名悬浮问题" class="headerlink" title="UITableView 的plain样式分组名悬浮问题"></a>UITableView 的plain样式分组名悬浮问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pragma mark - 禁止session滚动</span></span><br><span class="line">-  (void)scrollViewDidScroll:(UIScrollView *)scrollView &#123;</span><br><span class="line">-  </span><br><span class="line">    <span class="keyword">if</span> (scrollView == _tableView)</span><br><span class="line">    &#123;</span><br><span class="line">        CGFloat sectionHeaderHeight = 25; //sectionHeaderHeight</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (scrollView.contentOffset.y&lt;=sectionHeaderHeight&amp;&amp;scrollView.contentOffset.y&gt;=0) &#123;</span><br><span class="line">        </span><br><span class="line">            scrollView.contentInset = UIEdgeInsetsMake(-scrollView.contentOffset.y, 0, 0, 0);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (scrollView.contentOffset.y&gt;=sectionHeaderHeight) &#123;</span><br><span class="line">        </span><br><span class="line">            scrollView.contentInset = UIEdgeInsetsMake(-sectionHeaderHeight, 0, 0, 0);</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            scrollView.contentInset = UIEdgeInsetsMake(64, 0, 0, 0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="iOS-支持-ipv6-问题"><a href="#iOS-支持-ipv6-问题" class="headerlink" title="iOS 支持 ipv6 问题"></a>iOS 支持 ipv6 问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1.AFNetworking 换成最新版本</span><br><span class="line"></span><br><span class="line">2.友盟等与网络有关的第三方SDK换成最新版本</span><br><span class="line"></span><br><span class="line">3.服务器请求地址不要使用ip，要使用域名</span><br><span class="line"></span><br><span class="line">4.如果用到底层API需要单独处理，尽量使用NSURLSession</span><br><span class="line"></span><br><span class="line">5.检测网络状况的类在ios8一下可能会有点问题</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">### 判断字符串是否为空</span></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">+ (BOOL)isEmpty:(NSString *)str</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!str) &#123;</span><br><span class="line">        <span class="built_in">return</span> YES;</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        NSCharacterSet *<span class="built_in">set</span>=[NSCharacterSet whitespaceAndNewlineCharacterSet];</span><br><span class="line">        </span><br><span class="line">        NSString *trimedString=[str stringByTrimmingCharactersInSet:<span class="built_in">set</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (trimedString.length==0) &#123;</span><br><span class="line">            <span class="built_in">return</span> YES;</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">return</span> NO;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="URLDecode-解码"><a href="#URLDecode-解码" class="headerlink" title="URLDecode 解码"></a>URLDecode 解码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (NSString *)URLDecodedString:(NSString *)str</span><br><span class="line">&#123;</span><br><span class="line">    NSString *decodedString=(__bridge_transfer NSString *)CFURLCreateStringByReplacingPercentEscapesUsingEncoding(NULL, (__bridge CFStringRef)str, CFSTR(<span class="string">""</span>), CFStringConvertNSStringEncodingToEncoding(NSUTF8StringEncoding));</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> decodedString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="textView-根据输入内容改变高度（最多显示5行）"><a href="#textView-根据输入内容改变高度（最多显示5行）" class="headerlink" title="textView 根据输入内容改变高度（最多显示5行）"></a>textView 根据输入内容改变高度（最多显示5行）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (void)textViewDidChange:(UITextView *)textView</span><br><span class="line">&#123;</span><br><span class="line">    NSString *textViewText = [textView.text stringByReplacingOccurrencesOfString:@<span class="string">" "</span> withString:@<span class="string">""</span>];</span><br><span class="line">    </span><br><span class="line">    //判断输入的字符是否是空格</span><br><span class="line">    <span class="keyword">if</span> (![self isEmpty:textViewText]) &#123;</span><br><span class="line"></span><br><span class="line">        CGFloat h = [inputTextView.layoutManager usedRectForTextContainer:inputTextView.textContainer].size.height;</span><br><span class="line">        inputTextView.contentSize = CGSizeMake(inputTextView.contentSize.width, h+20);</span><br><span class="line">        CGFloat five_h = hight_text_one*5.0f;</span><br><span class="line">        h = h&gt;five_h?five_h:h;</span><br><span class="line">        CGRect frame = inputTextView.frame;</span><br><span class="line">        CGFloat diff = toolBar.frame.size.height - inputTextView.frame.size.height;</span><br><span class="line">        <span class="keyword">if</span> (frame.size.height == h+20) &#123;</span><br><span class="line">            <span class="keyword">if</span> (h == five_h) &#123;</span><br><span class="line">                [inputTextView <span class="built_in">set</span>ContentOffset:CGPointMake(0, inputTextView.contentSize.height - h - 20) animated:NO];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        frame.size.height = h+20;</span><br><span class="line">        inputTextView.frame = frame;</span><br><span class="line">        [inputTextView <span class="built_in">set</span>ContentOffset:CGPointZero animated:YES];</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      // 处理输入为空格的情况</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="“Request-failed-unacceptable-content-type-text-plain-text-html-”-解决方案"><a href="#“Request-failed-unacceptable-content-type-text-plain-text-html-”-解决方案" class="headerlink" title="“Request failed: unacceptable content-type: text/plain(text/html)” 解决方案"></a>“Request failed: unacceptable content-type: text/plain(text/html)” 解决方案</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">此时需要修改AFNetworking可接收的Content-Type，前往AFNetworking源代码目录找到AFURLResponseSerialization.m文件将里面的代码：</span><br><span class="line">self.acceptableContentTypes =[NSSetsetWithObjects:@<span class="string">"application/json"</span>,@<span class="string">"text/json"</span>,@<span class="string">"text/javascript"</span>,nil];</span><br><span class="line">修改为：</span><br><span class="line"></span><br><span class="line">self.acceptableContentTypes =[NSSet <span class="built_in">set</span>WithObjects:@<span class="string">"application/json"</span>,@<span class="string">"text/json"</span>,@<span class="string">"text/javascript"</span>,@<span class="string">"text/plain"</span> , nil]; </span><br><span class="line"></span><br><span class="line">self.acceptableContentTypes =[NSSet <span class="built_in">set</span>WithObjects:@<span class="string">"application/json"</span>,@<span class="string">"text/json"</span>,@<span class="string">"text/javascript"</span>,@<span class="string">"text/html"</span>,nil];</span><br></pre></td></tr></table></figure>
<h3 id="UILabel的行间距，字间距以及高度计算"><a href="#UILabel的行间距，字间距以及高度计算" class="headerlink" title="UILabel的行间距，字间距以及高度计算"></a>UILabel的行间距，字间距以及高度计算</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/06/apple 内购流程梳理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东折">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Try and try again！The worst result is failure!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/06/apple 内购流程梳理/" itemprop="url">apple 内购流程梳理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-06T00:00:00+08:00">
                2016-05-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/06/apple 内购流程梳理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/06/apple 内购流程梳理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>第一次接触内购，网上搜了很多资料，大多数都是讲的基本的用法，不能用来处理一些特殊情况，但是我们需要解决的往往都是一些特殊情况。经过一段时间的努力和时间，终于大体了解了内购的基本流程，这里整理一下内购的代码，以便以后使用或他人借鉴。</p>
<h2 id="准备部分"><a href="#准备部分" class="headerlink" title="准备部分"></a>准备部分</h2><p>没有开发者帐号以及证书没有配置好的请自行百度配置。</p>
<h3 id="创建一个-AppID-和-BoundleID"><a href="#创建一个-AppID-和-BoundleID" class="headerlink" title="创建一个 AppID 和 BoundleID"></a>创建一个 AppID 和 BoundleID</h3><p>进入苹果的<a href="https://developer.apple.com" target="_blank" rel="external">Apple Developer</a> 创建一个 AppID 和 BoundleID， 进入开发者中心后，点击 <code>Account</code> 选项 ，在点击 <code>Certificates, IDs &amp; Profiles</code> ，在点击 <code>App IDs</code>  如图</p>
<p><img src="http://img2.ph.126.net/PHbMEsByXbQlbE0Mhl8c4w==/1998472334747494370.png" alt=""></p>
<p> 最后点击页面上的加号创建AppID（AppID 和 BoundleID 的命名按照苹果的要求来就好了，最后选择需要的服务，要勾选上内购）。</p>
<p><img src="http://img0.ph.126.net/m9OGzhRpudMDV93Xt3j0dA==/6598061526206718111.jpg" alt=""></p>
<h3 id="新建一个-App-应用"><a href="#新建一个-App-应用" class="headerlink" title="新建一个 App 应用"></a>新建一个 App 应用</h3><p>进入苹果的<a href="https://itunesconnect.apple.com" target="_blank" rel="external">itunes Connect</a>，登录后点击 <code>我的 App</code> 然后创建一个新的应用，如图</p>
<p><img src="http://img0.ph.126.net/cut-LzCmQQFq0EEXEvJcTA==/6598175875415825922.jpg" alt=""></p>
<p>按照要求填写上面申请好的AppID 和 BoundleID，填写好以后，点击 <code>创建</code> 就有一个新应用了。</p>
<h3 id="添加付费项目"><a href="#添加付费项目" class="headerlink" title="添加付费项目"></a>添加付费项目</h3><p>点击添加的应用，进入下一个页面后点击 <code>功能</code>，然后添加 App 内购项目如图</p>
<p><img src="http://img1.ph.126.net/hqxC0_wml4cGOGcUw6RZsQ==/6598202263694892499.jpg" alt=""></p>
<p>一般都是消耗型项目吧，这里我选择的是消耗型项目。</p>
<p>然后是填写具体的内购信息，不知道该填什么的可以随便填一些信息，看看效果，如图</p>
<p><img src="http://img1.ph.126.net/fysaS4F0T-wJmb2BVVmpkA==/3756002089328009485.jpg" alt=""></p>
<p><img src="http://img0.ph.126.net/Rjxx7L3gWuFtXk3ItI_Nlw==/4860509897940868893.jpg" alt=""></p>
<p>测试的时候照片可以不上串，产品Id 是唯一的（比较重要）。</p>
<h3 id="添加测试账户"><a href="#添加测试账户" class="headerlink" title="添加测试账户"></a>添加测试账户</h3><p>总不能用正式帐号去测试吧，那样要花好多钱的，这里我们用测试帐号去测试内购流程。</p>
<p>进入苹果的<a href="https://itunesconnect.apple.com" target="_blank" rel="external">itunes Connect</a>，登录后点击 <code>用户和职能</code> 然后在点击 <code>沙箱技术测试员</code>，最后添加测试帐号，如图</p>
<p><img src="http://img0.ph.126.net/NCl3SRrwWzgF3rzCb-WUZQ==/6598193467601866965.jpg" alt=""></p>
<p>这里的邮箱可以随便填写，不用去验证，填完后准备工作就完成了。</p>
<p>最后，注意一下测试内购时，把 App Store 里的正式帐号注销掉，并且不要用测试帐号去登录 App Store。</p>
<h2 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h2><p>在正式编码前，我们先来了解一下内购的大体流程，请看图</p>
<p><img src="http://img1.ph.126.net/ldHXIWZdgXmOk9iFK1Vfvg==/6598149487136756941.jpg" alt=""></p>
<p>这是从网上找的一张图，很清楚的描述了内购的流程，下面的代码我会按照这张图的流程来进行。</p>
<h3 id="在工程里导入storekit-framework，在内购类导入-import"><a href="#在工程里导入storekit-framework，在内购类导入-import" class="headerlink" title="在工程里导入storekit.framework，在内购类导入#import \"></a>在工程里导入storekit.framework，在内购类导入#import \<storekit storekit.h\=""></storekit></h3><h3 id="客户端代码"><a href="#客户端代码" class="headerlink" title="客户端代码"></a>客户端代码</h3><p><strong>.h文件</strong></p>
<pre><code>//
//  StoreAPI.h
//

//内购支付类
#import &lt;Foundation/Foundation.h&gt;
#import &lt;StoreKit/StoreKit.h&gt;

// 加入 SKPaymentTransactionObserver 和 SKProductsRequestDelegate 监听机制
@interface StoreAPI : NSObject&lt;SKPaymentTransactionObserver,SKProductsRequestDelegate&gt;

+ (instancetype)shareInstance;

/*
 请求商品，购买页面点击购买时调用的方法
 @param:type  商品id
 */
- (void)requestProductData:(NSString *)type;

//恢复购买
- (void)restoreProduct;

@end
</code></pre><p><strong>.m文件</strong></p>
<pre><code>//
//  StoreAPI.m
//

#import &quot;StoreAPI.h&quot;

//购买验证URL
#define kAppStoreVerifyURL @&quot;https://buy.itunes.apple.com/verifyReceipt&quot; //实际购买验证URL
#define kSandboxVerifyURL @&quot;https://sandbox.itunes.apple.com/verifyReceipt&quot; //开发阶段沙盒验证URL

static StoreAPI *storeAPI = nil;
@implementation StoreAPI
{
    NSString *productId;        
}

//单例
+ (instancetype)shareInstance
{
     static dispatch_once_t onceToken;
     dispatch_once(&amp;onceToken, ^{

          storeAPI = [[TDStoreAPI alloc]init];
         // 添加观察者，观察内购的状态
        [[SKPaymentQueue defaultQueue] addTransactionObserver:storeAPI];
    });
        return storeAPI;  
}

// 请求商品
// 这里的产品Id是服务端传过来的，也可以保存在手机上(不利于修改)
- (void)requestProductData:(NSString *)type
{
    productId = type;

    //判断设备是否与支持内购
    if (![SKPaymentQueue canMakePayments]) {
        NSLog(@&quot;不允许程序内付费&quot;);
        return;
    }

    // 创建请求 
    NSArray *product=[[NSArray alloc]initWithObjects:type, nil];
    NSSet *nsset=[NSSet setWithArray:product];
    SKProductsRequest *request=[[SKProductsRequest alloc]initWithProductIdentifiers:nsset];
    request.delegate=self;
    [request start];
}

#pragma mark - SKProductsRequestDelegate
//收到产品返回的信息
- (void)productsRequest:(SKProductsRequest *)request didReceiveResponse:(SKProductsResponse *)response
{
    NSArray *product=response.products;
    NSLog(@&quot;ProductID:%@&quot;,response.invalidProductIdentifiers);
    NSLog(@&quot;产品付费数量：%lu&quot;,(unsigned long)[product count]);

    if ([product count]==0) {
        NSLog(@&quot;没有商品&quot;);
        return;
    }

    SKProduct *p=nil;

    for (SKProduct *pro in product) {

        NSLog(@&quot;%@&quot;,[pro description]);
        NSLog(@&quot;%@&quot;,[pro localizedTitle]);
        NSLog(@&quot;%@&quot;,[pro localizedDescription]);
        NSLog(@&quot;%@&quot;,[pro price]);
        NSLog(@&quot;%@&quot;,[pro productIdentifier]);

        if ([pro.productIdentifier isEqualToString:productId]) {

            p=pro;
        }
    }

    SKPayment *payment=[SKPayment paymentWithProduct:p];

    // 将支付请求添加进支付队列
    [[SKPaymentQueue defaultQueue]addPayment:payment];
}

//请求失败（代理方法）
- (void)request:(SKRequest *)request didFailWithError:(NSError *)error
{
    // 在这里可以做一些购买失败的弹框之类的处理
    NSLog(@&quot;--错误--：%@&quot;,error);
}

//请求结束
- (void)requestDidFinish:(SKRequest *)request
{
    NSLog(@&quot;反馈信息结束&quot;);
}

#pragma mark SKPaymentTransactionObserver

//监听购买结果（嗯，这个方法很重要！！！）
- (void)paymentQueue:(SKPaymentQueue *)queue updatedTransactions:(NSArray *)transactions
{
    //记录了所有的购买记录
    for (SKPaymentTransaction *tran in transactions) {

        switch (tran.transactionState) {
            case SKPaymentTransactionStatePurchased:
            {
                NSLog(@&quot;交易完成&quot;);   
                [self completeTransaction:tran];
            }
                break;

            case SKPaymentTransactionStatePurchasing:
            {
                NSLog(@&quot;商品添加进列表&quot;);
            }
                break;

            case SKPaymentTransactionStateRestored:
            {
                [self restoreTransaction:tran];
                NSLog(@&quot;已经购买过商品&quot;);                    
            }
                break;
            case SKPaymentTransactionStateFailed:
            {
                NSLog(@&quot;交易失败&quot;);
                [self failedTransaction:tran];               
            }
                break;     
            default:
                break;
        }   
    }
}

//恢复购买（自定义方法）
- (void)restoreProduct{
   [[SKPaymentQueue defaultQueue] restoreCompletedTransactions];
}

//交易成功（自定义方法）
- (void)completeTransaction:(SKPaymentTransaction *)transaction
{
    //从沙盒中获取交易凭证并且拼接成请求体数据
    NSURL *receiptUrl=[[NSBundle mainBundle] appStoreReceiptURL];
    NSData *receiptData;
    // 获取凭证的方法在ios7.0以后和以前有点不一样
    if (NSFoundationVersionNumber &gt;= NSFoundationVersionNumber_iOS_7_0)
    {
        receiptData = [NSData dataWithContentsOfURL:receiptUrl];
    }else
    {
        receiptData = transaction.transactionReceipt;
    }
    //BASE64 编码
    NSString *receiptString=[receiptData base64EncodedStringWithOptions:NSDataBase64EncodingEndLineWithLineFeed];

    // 保存交易记录
    [self recordTransaction:transaction];
    [self provideContent:transaction.payment.productIdentifier];

    NSString * productIdentifier = transaction.payment.productIdentifier;

    if ([productIdentifier length] &gt; 0) {
        // 向自己的服务器验证购买凭证
        [self verifyPurchaseWithPaymentTransaction:receiptString];
    }

    // Remove the transaction from the payment queue.
    [[SKPaymentQueue defaultQueue] finishTransaction: transaction];
}

//交易失败（自定义方法）
- (void)failedTransaction:(SKPaymentTransaction *)transaction {
    if(transaction.error.code != SKErrorPaymentCancelled) {
        NSLog(@&quot;购买失败&quot;);
      } else {
        NSLog(@&quot;用户取消交易&quot;);
    }
    [[SKPaymentQueue defaultQueue] finishTransaction: transaction];
}

//恢复交易
- (void) restoreTransaction: (SKPaymentTransaction *)transaction
{
    NSLog(@&quot; 交易恢复处理&quot;);
    [[SKPaymentQueue defaultQueue] finishTransaction: transaction];

}

// 恢复购买完成
- (void)paymentQueueRestoreCompletedTransactionsFinished:(SKPaymentQueue *)queue
{
    NSLog(@&quot;恢复成功&quot;);
//    if (queue.transactions.count == 0) {

//    }else{

//    }
}

//记录交易
- (void)recordTransaction:(SKPaymentTransaction *)transaction {
    // Optional: Record the transaction on the server side...
    NSLog(@&quot;Hello World&quot;);
}

//下载
- (void)provideContent:(NSString *)productIdentifier {
    NSLog(@&quot;Hello World&quot;);
}


//验证购买凭证
-(void)verifyPurchaseWithPaymentTransaction:(NSString *)receiptString{

    // 这里的代码是客户端自己向苹果验证的步骤（服务端的和这里相似）
    //发送网络POST请求，对购买凭据进行验证---测试阶段对沙盒进行验证
    NSURL *url = [NSURL URLWithString:kSandboxVerifyURL];

    //国内访问苹果服务器比较慢 timeoutInterval需要长一点
    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:10.0f];
  request.HTTPMethod = @&quot;POST&quot;;

    if (receiptString.length &lt; 20) {
        return;
    }
    NSString *bodyString = [NSString stringWithFormat:@&quot;{\&quot;receipt-data\&quot; : \&quot;%@\&quot;}&quot;, receiptString];//拼接请求数据
   NSData *bodyData = [bodyString dataUsingEncoding:NSUTF8StringEncoding];
   request.HTTPBody = bodyData;
   //提交验证请求，并获得官方的验证JSON结果
    NSError *error;
    NSData *result = [NSURLConnection sendSynchronousRequest:request returningResponse:nil error:&amp;error];

    if (error) {
        NSLog(@&quot;验证失败&quot;);
        return;
    }
   NSDictionary *dic = [NSJSONSerialization JSONObjectWithData:result options:NSJSONReadingAllowFragments error:&amp;error];
  //  如果status的值为0， 就说明该receipt为有效的。 否则就是无效的。
   if ([dic[@&quot;status&quot;] intValue] == 0) {
       NSLog(@&quot;验证成功&quot;);           
    }else
    {
        NSLog(@&quot;验证失败&quot;);      
   }
}

- (void)dealloc
{
    [[SKPaymentQueue defaultQueue]removeTransactionObserver:self];
}

@end
</code></pre><h3 id="服务器端处理"><a href="#服务器端处理" class="headerlink" title="服务器端处理"></a>服务器端处理</h3><pre><code>接收ios端发过来的购买凭证。
判断凭证是否已经存在或验证过，然后存储该凭证。
将该凭证发送到苹果的服务器验证，并将验证结果返回给客户端。
如果需要，修改用户相应的会员权限。
考虑到网络异常情况，服务器的验证应该是一个可恢复的队列，如果网络失败了，应该进行重试。
</code></pre><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol>
<li><p>观察者应该在程序启动的时候就创建好，因为程序重新启动后，苹果会继续未完成的订单，这样就不会漏掉之前的交易信息。</p>
</li>
<li><p>苹果不会提供等待的提示弹框，这需要自己去实现。</p>
</li>
<li><p>由于攻击者可以伪造支付成功的凭证，所以需要增加服务器验证。客户端将支付凭证发给服务端，由服务端向苹果的服务器进行二次验证，确保凭证的有效性。</p>
</li>
<li><p>向苹果提交的是正式版的，但是苹果审核App时，会在sandbox 环境购买，所以产生的凭证需要连接苹果的测试服务器验证，但是提交的App连接的是线上的服务器，会造成验证失败的问题。解决方案是：如果返回的code 是 21007，那么再向苹果的测试服务器验证一次，如果code 是 0，表示验证成功。</p>
</li>
<li><p>考虑到断网的情况，客户端发送的购买凭证应该进行本地的持久化存储，如果程序退出，崩溃或断网，可以重新向服务器发送凭证，当服务器返回验证成功后可以删除相应的凭证。</p>
</li>
<li><p>由于苹果那边充值成功后，服务器还需要进行验证（连接的是国外的服务器，响应比较慢），所以充值的金额不能及时到帐，需要等几秒。（或许是我没有发现更好地解决方法）</p>
</li>
<li><p>如果向服务器发送购买凭证过程中断网或因其他原因失败，导致服务器没有收到购买凭证，或许需要监听网络状况，联网后再次发送也可以等程序下次启动时再次发送，看具体要求吧。</p>
</li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://blog.devtang.com/2012/12/09/in-app-purchase-check-list/" target="_blank" rel="external">唐巧大神的博客</a></p>
<p><a href="http://www.himigame.com/iphone-cocos2d/550.html" target="_blank" rel="external">李华明Himi 的博客</a></p>
<p><a href="http://bbs.tairan.com/thread-13220-1-1.html" target="_blank" rel="external">iOS应用内置付费详尽攻略（全文）</a></p>
<p><a href="http://blog.csdn.net/shenjie12345678/article/details/40978977" target="_blank" rel="external"> iOS应用程序内购/内付费</a></p>
<p><a href="http://www.tairan.com/archives/2215/" target="_blank" rel="external">iOS内购IAP（In App Purchases）入门</a></p>
<p><a href="http://www.lanrenios.com/tutorials/advanced/2012/1125/524.html" target="_blank" rel="external">iOS开发内购教程In App Purchase 需要了解的</a></p>
<p><a href="http://www.cocoachina.com/bbs/read.php?tid=92060" target="_blank" rel="external">IAP相关资源收集及开发总结</a></p>
<p><a href="http://www.cocoachina.com/ios/20140528/8585.html" target="_blank" rel="external">iOS内置付费开发笔记</a></p>
<p><a href="http://www.cocoachina.com/ios/20150521/11889.html" target="_blank" rel="external">iOS证书说明和发布内购流程整理</a></p>
<p><a href="http://blog.csdn.net/tspangle/article/details/39315355" target="_blank" rel="external">iOS- 给App添加内购&amp; 验证购买iOS7新特性 </a></p>
<p><a href="http://www.cocoachina.com/ios/20150612/12110.html" target="_blank" rel="external">应用内购（In-App Purchase）常见问题解答</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/27/hexo 安装与配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东折">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Try and try again！The worst result is failure!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/27/hexo 安装与配置/" itemprop="url">hexo 安装与配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-27T00:00:00+08:00">
                2016-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/27/hexo 安装与配置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/27/hexo 安装与配置/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>总想弄个自己的博客，写一些东西（或感悟、或经验、或代码、或计划）。选择困难症的我纠结到底是用CSDN还是新浪抑或网易……还有很多，都挑花眼了，各有各的有点，也各有各的不足。那么到头来我为什么选择了Hexo + GitHub 来创建自己的博客呢？因为它没广告啊！！！当然还可以根据自己的喜好选择喜欢的主题，同时看着自己的作品是不是有一种满足感呢？最后，作为一个程序猿用别的博客怎么能体现程序猿的与众不同呢？</p>
<h2 id="Hexo-简单介绍"><a href="#Hexo-简单介绍" class="headerlink" title="Hexo 简单介绍"></a>Hexo 简单介绍</h2><p><a href="https://hexo.io/" target="_blank" rel="external">hexo</a> 是一个基于<a href="http://nodejs.cn/" target="_blank" rel="external">Node.js</a>的静态博客框架，可以方便的生成静态网页并且托管在<a href="https://github.com/" target="_blank" rel="external">github</a> 上。hexo是一个开源的博客框架，我们可以任意使用修改，但是很多功能要自己去实现，没有计算机基础的人使用起来可能比较困难。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>前面提到hexo是基于Node.js的博客框架，所以安装Hexo之前需要先Node.js 和设置 github(托管代码) </p>
<h3 id="GitHub-设置"><a href="#GitHub-设置" class="headerlink" title="GitHub 设置"></a>GitHub 设置</h3><ul>
<li>首先你要注册一个<a href="https://github.com/" target="_blank" rel="external">github</a>帐号</li>
<li>创建一个库（new repository）命名为YourSiteName.github.io/</li>
<li>根据自己的喜好简单设置一下github生成的静态网页</li>
</ul>
<p><a href="http://blog.csdn.net/renfufei/article/details/37725057" target="_blank" rel="external">请参考</a></p>
<p>￼<a href="https://git-scm.com/" target="_blank" rel="external">下载Git</a></p>
<h3 id="安装Node-js"><a href="#安装Node-js" class="headerlink" title="安装Node.js"></a>安装Node.js</h3><p><a href="https://nodejs.org/en/" target="_blank" rel="external">下载Node.js</a> 并安装</p>
<h2 id="Hexo-安装"><a href="#Hexo-安装" class="headerlink" title="Hexo 安装"></a>Hexo 安装</h2><ul>
<li>安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure>
<ul>
<li>初始化</li>
</ul>
<p>安装完成后，建一个文件夹（如hexo），执行以下指令(在hexo路径下)，Hexo 即会自动在目标文件夹建立网站所需要的所有文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init</span><br></pre></td></tr></table></figure>
<ul>
<li>查看博客</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g</span><br><span class="line">$ hexo s</span><br></pre></td></tr></table></figure>
<p>然后在浏览器中输入<a href="http://localhost:4000/" target="_blank" rel="external">localhost:4000</a> 就可以看到你的博客了。</p>
<p>如果安装过程中出现错误可以尝试在命令行前加上 <code>sudo</code></p>
<p><a href="https://hexo.io/docs/index.html" target="_blank" rel="external">详情请参考</a></p>
<h2 id="Hexo-基本使用"><a href="#Hexo-基本使用" class="headerlink" title="Hexo 基本使用"></a>Hexo 基本使用</h2><p>既然博客已经安装好了，那么怎么写博客呢？博客是基于MarkDown语法的，不了解MarkDown的请<a href="http://wowubuntu.com/markdown/#list" target="_blank" rel="external">点击这里</a>。</p>
<p>编辑器MAC环境下免费的有Mou 和MacDown 比较给力，其他的不熟悉。</p>
<ul>
<li>创建文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"Hexo使用"</span></span><br></pre></td></tr></table></figure>
<p>或者直接进入hexo\source\_posts路径下添加 xxx.md 类型的文件，然后打开文件编辑</p>
<pre><code>title: Hexo使用    // 标题
categories: hexo    // 分类
tags: [hexo，blog]  //标签，多个用逗号隔开
---

#这里是正文，用markdown编写
</code></pre><ul>
<li>预览</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g  </span><br><span class="line">$ hexo s  </span><br><span class="line">$ 访问localhost:4000预览效果。（退出server用Ctrl+c）</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">- 提交到git</span><br><span class="line"></span><br><span class="line">编辑hexo\\_config.yml，把下面的 abc 换成你的用户名。</span><br><span class="line"></span><br><span class="line">``` bash</span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repository: https://github.com/abc/abc.github.io</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">保存文件并运行</span><br><span class="line"></span><br><span class="line">``` bash</span><br><span class="line">$ hexo g  </span><br><span class="line">$ hexo s  </span><br><span class="line">$ hexo d</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">然后在浏览器输入abc.github.io 就能看到 Git 的博客发生了变化。</span><br><span class="line"></span><br><span class="line"><span class="comment">## Hexo 配置</span></span><br><span class="line"></span><br><span class="line">Okay</span><br><span class="line"></span><br><span class="line">Hexo 的基本使用已经结束了，下面是怎样装饰你的博客了，如果你对默认的样式很满意，后面的可以跳过了。</span><br><span class="line"></span><br><span class="line">我这里使用的主题是[next](http://theme-next.iissnan.com/) </span><br><span class="line"></span><br><span class="line">Hexo 有两个配置文件，在hexo路径下的 _config.yml 文件是 `站点配置文件` ，在 hexo\themes\hexo-theme-next 路径下的 _config.yml 文件是`主题配置文件`。</span><br><span class="line"></span><br><span class="line"><span class="comment">### 配置文件</span></span><br><span class="line"></span><br><span class="line">- 站点配置文件</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Hexo Configuration</span></span><br><span class="line">        <span class="comment">## Docs: https://hexo.io/docs/configuration.html</span></span><br><span class="line">        <span class="comment">## Source: https://github.com/hexojs/hexo/</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Site  这里的配置可以参考我的博客</span></span><br><span class="line">        title: Try、Try Again！The worst result is failure!    // 博客title</span><br><span class="line">        subtitle:   // 副标题</span><br><span class="line">        description: 以出以入，以就鲜絜，似善化。其万折也必东，似志。是故君子见大水必观焉。 --  荀子·宥坐   // 描述</span><br><span class="line">        author: 东折   // 作者</span><br><span class="line">        language: zh-Hans  // 使用语言</span><br><span class="line">        timezone:</span><br><span class="line">        email: zhd_dong@163.com  // 邮箱</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># URL  这里没有设置</span></span><br><span class="line">        <span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'</span></span><br><span class="line">        url: http://yoursite.com</span><br><span class="line">        root: /</span><br><span class="line">        permalink: :year/:month/:day/:title/</span><br><span class="line">        permalink_defaults:</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Directory  这里没有设置</span></span><br><span class="line">        <span class="built_in">source</span>_dir: <span class="built_in">source</span></span><br><span class="line">        public_dir: public</span><br><span class="line">        tag_dir: tags</span><br><span class="line">        archive_dir: archives</span><br><span class="line">        category_dir: categories</span><br><span class="line">        code_dir: downloads/code</span><br><span class="line">        i18n_dir: :lang</span><br><span class="line">        skip_render:</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Writing  这里没有设置</span></span><br><span class="line">        new_post_name: :title.md <span class="comment"># File name of new posts</span></span><br><span class="line">        default_layout: post</span><br><span class="line">        titlecase: <span class="literal">false</span> <span class="comment"># Transform title into titlecase</span></span><br><span class="line">        external_link: <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line">        filename_<span class="keyword">case</span>: 0</span><br><span class="line">        render_drafts: <span class="literal">false</span></span><br><span class="line">        post_asset_folder: <span class="literal">false</span></span><br><span class="line">        relative_link: <span class="literal">false</span></span><br><span class="line">        max_open_file: 100</span><br><span class="line">        future: <span class="literal">true</span></span><br><span class="line">        highlight:</span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">          line_number: <span class="literal">true</span></span><br><span class="line">          auto_detect: <span class="literal">false</span></span><br><span class="line">          tab_replace:</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Category &amp; Tag</span></span><br><span class="line">        default_category: uncategorized</span><br><span class="line">        category_map:</span><br><span class="line">        tag_map:</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">#archive: 1</span></span><br><span class="line">        <span class="comment">#category: 1</span></span><br><span class="line">        <span class="comment">#tag: 1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Date / Time format</span></span><br><span class="line">        <span class="comment">## Hexo uses Moment.js to parse and display date</span></span><br><span class="line">        <span class="comment">## You can customize the date format as defined in</span></span><br><span class="line">        <span class="comment">## http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line">        date_format: YYYY-MM-DD</span><br><span class="line">        time_format: HH:mm:ss</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Pagination</span></span><br><span class="line">        <span class="comment">## Set per_page to 0 to disable pagination</span></span><br><span class="line">        per_page: 10   // 这里设置一页显示多少条博客</span><br><span class="line">        pagination_dir: page</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Extensions</span></span><br><span class="line">        <span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line">        <span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line">        theme: hexo-theme-next  // 在这里设置想要的主题（主题对应的文件夹的名称）</span><br><span class="line">        </span><br><span class="line">        duoshuo_shortname: yulncbd   // 这里添加多说评论</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Deployment  // 这里设置Git 的相关信息</span></span><br><span class="line">        <span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line">        deploy:</span><br><span class="line">          <span class="built_in">type</span>: git</span><br><span class="line">          repository: https://github.com/YulncBd/YulncBd.github.io  // 这里将YulncBd替换成自己用户名</span><br><span class="line">          </span><br><span class="line">    </span><br><span class="line">    `站点配置文件` 主要配置了博客简介，git，多说评论等一些信息。自己可以尝试一下其他的设置，看看什么效果。设置完成后执行一下命令查看结果</span><br><span class="line">    </span><br><span class="line">        hexo g</span><br><span class="line">        hexo s</span><br><span class="line">        hexo d</span><br><span class="line">          </span><br><span class="line">    到用浏览器打开 `localhost:4000` 查看效果，再到 `你的用户名.github.io` 查看Git 上你博客的变化。</span><br><span class="line"></span><br><span class="line">- 主题配置文价</span><br><span class="line"></span><br><span class="line"> 可以打开 zh-Hans.yml 文件查看对应的汉字设置</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        <span class="comment"># Site Information Settings</span></span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Put your favicon.ico into `hexo-site/source/` directory.</span></span><br><span class="line">        favicon: /favicon.ico</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Set default keywords (Use a comma to separate)</span></span><br><span class="line">        keywords: <span class="string">"Hexo, NexT"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Set rss to false to disable feed link.</span></span><br><span class="line">        <span class="comment"># Leave rss as empty to use site's feed link.</span></span><br><span class="line">        <span class="comment"># Set rss to specific value if you have burned your feed already.</span></span><br><span class="line">        rss: <span class="literal">false</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Specify the date when the site was setup</span></span><br><span class="line">        since: 2016</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        <span class="comment"># Menu Settings</span></span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        </span><br><span class="line">        // 这里设置导航栏（添加了分类 和 标签，具体设置后面在介绍）</span><br><span class="line">        <span class="comment"># When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash (/archives -&gt; archives)</span></span><br><span class="line">        menu:</span><br><span class="line">          home: /</span><br><span class="line">          archives: archives</span><br><span class="line">          categories: categories</span><br><span class="line">          tags: tags</span><br><span class="line">          <span class="comment">#about: about</span></span><br><span class="line">          <span class="comment">#tags: /tags</span></span><br><span class="line">          <span class="comment">#commonweal: /404.html</span></span><br><span class="line">        </span><br><span class="line">        // 这里设置导航栏对应的图片</span><br><span class="line">        <span class="comment"># Enable/Disable menu icons.</span></span><br><span class="line">        <span class="comment"># Icon Mapping:</span></span><br><span class="line">        <span class="comment">#   Map a menu item to a specific FontAwesome icon name.</span></span><br><span class="line">        <span class="comment">#   Key is the name of menu item and value is the name of FontAwsome icon. Key is case-senstive.</span></span><br><span class="line">        <span class="comment">#   When an question mask icon presenting up means that the item has no mapping icon.</span></span><br><span class="line">        menu_icons:</span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">          <span class="comment">#KeyMapsToMenuItemKey: NameOfTheIconFromFontAwesome</span></span><br><span class="line">          home: home</span><br><span class="line">          about: user</span><br><span class="line">          categories: th</span><br><span class="line">          tags: tags</span><br><span class="line">          archives: archive</span><br><span class="line">          commonweal: heartbeat</span><br><span class="line">          search: search</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        <span class="comment"># Scheme Settings</span></span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        </span><br><span class="line">        // 这里设置主题的样式（可以都选择看一下效果）</span><br><span class="line">        <span class="comment"># Schemes</span></span><br><span class="line">        <span class="comment">#scheme: Muse</span></span><br><span class="line">        <span class="comment">#scheme: Mist</span></span><br><span class="line">        scheme: Pisces</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        <span class="comment"># Font Settings</span></span><br><span class="line">        <span class="comment"># - Find fonts on Google Fonts (https://www.google.com/fonts)</span></span><br><span class="line">        <span class="comment"># - All fonts set here will have the following styles:</span></span><br><span class="line">        <span class="comment">#     light, light italic, normal, normal intalic, bold, bold italic</span></span><br><span class="line">        <span class="comment"># - Be aware that setting too much fonts will cause site running slowly</span></span><br><span class="line">        <span class="comment"># - Introduce in 5.0.1</span></span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        font:</span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Uri of fonts host. E.g. //fonts.googleapis.com (Default)</span></span><br><span class="line">          host:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Global font settings used on &lt;body&gt; element.</span></span><br><span class="line">          global:</span><br><span class="line">            <span class="comment"># external: true will load this font family from host.</span></span><br><span class="line">            external: <span class="literal">true</span></span><br><span class="line">            family: Lato</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Font settings for Headlines (h1, h2, h3, h4, h5, h6)</span></span><br><span class="line">          <span class="comment"># Fallback to `global` font settings.</span></span><br><span class="line">          headings:</span><br><span class="line">            external: <span class="literal">true</span></span><br><span class="line">            family:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Font settings for posts</span></span><br><span class="line">          <span class="comment"># Fallback to `global` font settings.</span></span><br><span class="line">          posts:</span><br><span class="line">            external: <span class="literal">true</span></span><br><span class="line">            family:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Font settings for Logo</span></span><br><span class="line">          <span class="comment"># Fallback to `global` font settings.</span></span><br><span class="line">          <span class="comment"># The `size` option use `px` as unit</span></span><br><span class="line">          logo:</span><br><span class="line">            external: <span class="literal">true</span></span><br><span class="line">            family:</span><br><span class="line">            size:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Font settings for &lt;code&gt; and code blocks.</span></span><br><span class="line">          code:</span><br><span class="line">            external: <span class="literal">true</span></span><br><span class="line">            family:</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        <span class="comment"># Sidebar Settings</span></span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        </span><br><span class="line">        // 这里设置一些网站链接</span><br><span class="line">        <span class="comment"># Social Links</span></span><br><span class="line">        <span class="comment"># Key is the link label showing to end users.</span></span><br><span class="line">        <span class="comment"># Value is the target link (E.g. GitHub: https://github.com/iissnan)</span></span><br><span class="line">        social:</span><br><span class="line">          简书: http://www.jianshu.com/</span><br><span class="line">          GitHub: https://github.com/</span><br><span class="line">          知乎: http://www.zhihu.com</span><br><span class="line">          豆瓣: https://www.douban.com/</span><br><span class="line">        </span><br><span class="line">        // 这里设置链接的图片</span><br><span class="line">        <span class="comment"># Social Links Icons</span></span><br><span class="line">        <span class="comment"># Icon Mapping:</span></span><br><span class="line">        <span class="comment">#   Map a menu item to a specific FontAwesome icon name.</span></span><br><span class="line">        <span class="comment">#   Key is the name of the item and value is the name of FontAwsome icon. Key is case-senstive.</span></span><br><span class="line">        <span class="comment">#   When an globe mask icon presenting up means that the item has no mapping icon.</span></span><br><span class="line">        social_icons:</span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">          <span class="comment"># Icon Mappings.</span></span><br><span class="line">          <span class="comment"># KeyMapsToSocalItemKey: NameOfTheIconFromFontAwesome</span></span><br><span class="line">          GitHub: github</span><br><span class="line">          Twitter: twitter</span><br><span class="line">          Weibo: weibo</span><br><span class="line">        </span><br><span class="line">        // 这里设置头像</span><br><span class="line">        <span class="comment"># Sidebar Avatar</span></span><br><span class="line">        <span class="comment"># in theme directory(source/images): /images/avatar.jpg</span></span><br><span class="line">        <span class="comment"># in site  directory(source/uploads): /uploads/avatar.jpg</span></span><br><span class="line">        avatar: /uploads/avatar.png  </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Table Of Contents in the Sidebar</span></span><br><span class="line">        toc:</span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Automatically add list number to toc.</span></span><br><span class="line">          number: <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Creative Commons 4.0 International License.</span></span><br><span class="line">        <span class="comment"># http://creativecommons.org/</span></span><br><span class="line">        <span class="comment"># Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero</span></span><br><span class="line">        <span class="comment">#creative_commons: by-nc-sa</span></span><br><span class="line">        <span class="comment">#creative_commons:</span></span><br><span class="line">        </span><br><span class="line">        // 这里设置导航居左还是居右</span><br><span class="line">        sidebar:</span><br><span class="line">          <span class="comment"># Sidebar Position, available value: left | right</span></span><br><span class="line">          position: left</span><br><span class="line">          <span class="comment">#position: right</span></span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Sidebar Display, available value:</span></span><br><span class="line">          <span class="comment">#  - post    expand on posts automatically. Default.</span></span><br><span class="line">          <span class="comment">#  - always  expand for all pages automatically</span></span><br><span class="line">          <span class="comment">#  - hide    expand only when click on the sidebar toggle icon.</span></span><br><span class="line">          <span class="comment">#  - remove  Totally remove sidebar including sidebar toggler.</span></span><br><span class="line">          display: post</span><br><span class="line">          <span class="comment">#display: always</span></span><br><span class="line">          <span class="comment">#display: hide</span></span><br><span class="line">          <span class="comment">#display: remove</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        <span class="comment"># Misc Theme Settings</span></span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Custom Logo.</span></span><br><span class="line">        <span class="comment"># !!Only available for Default Scheme currently.</span></span><br><span class="line">        <span class="comment"># Options:</span></span><br><span class="line">        <span class="comment">#   enabled: [true/false] - Replace with specific image</span></span><br><span class="line">        <span class="comment">#   image: url-of-image   - Images's url</span></span><br><span class="line">        custom_logo:</span><br><span class="line">          enabled: <span class="literal">false</span></span><br><span class="line">          image:</span><br><span class="line">        </span><br><span class="line">        // 这里设置代码段的背景色</span><br><span class="line">        <span class="comment"># Code Highlight theme</span></span><br><span class="line">        <span class="comment"># Available value:</span></span><br><span class="line">        <span class="comment">#    normal | night | night eighties | night blue | night bright</span></span><br><span class="line">        <span class="comment"># https://github.com/chriskempson/tomorrow-theme</span></span><br><span class="line">        highlight_theme: night bright</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Automatically scroll page to section which is under &lt;!-- more --&gt; mark.</span></span><br><span class="line">        scroll_to_more: <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        // 这里设置博客显示信息</span><br><span class="line">        <span class="comment"># Automatically Excerpt. Not recommand.</span></span><br><span class="line">        <span class="comment"># Please use &lt;!-- more --&gt; in the post to control excerpt accurately.</span></span><br><span class="line">        auto_excerpt:</span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">true</span>  // 博客能否收起</span><br><span class="line">          length: 200   // 博客收起后显示高度</span><br><span class="line">          excerpt_link: <span class="built_in">read</span>_more <span class="comment">#替换为中文  // 阅读全文</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Wechat Subscriber</span></span><br><span class="line">        wechat_subscriber:</span><br><span class="line">          enabled: <span class="literal">false</span></span><br><span class="line">          qcode: /path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg</span><br><span class="line">          description: hello ex. subscribe to my blog by scanning my public wechat account</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        <span class="comment"># Third Party Services Settings</span></span><br><span class="line">        <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># MathJax Support</span></span><br><span class="line">        mathjax:</span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">          cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Swiftype Search API Key</span></span><br><span class="line">        <span class="comment">#swiftype_key:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Baidu Analytics ID</span></span><br><span class="line">        <span class="comment">#baidu_analytics:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Duoshuo ShortName</span></span><br><span class="line">        <span class="comment">#duoshuo_shortname:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Disqus</span></span><br><span class="line">        <span class="comment">#disqus_shortname:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Baidu Share</span></span><br><span class="line">        <span class="comment"># Available value:</span></span><br><span class="line">        <span class="comment">#    button | slide</span></span><br><span class="line">        <span class="comment">#baidushare:</span></span><br><span class="line">        <span class="comment">##  type: button</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Share</span></span><br><span class="line">        <span class="comment">#jiathis:</span></span><br><span class="line">        <span class="comment">#add_this_id:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Share</span></span><br><span class="line">        <span class="comment">#duoshuo_share: true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Google Webmaster tools verification setting</span></span><br><span class="line">        <span class="comment"># See: https://www.google.com/webmasters/</span></span><br><span class="line">        <span class="comment">#google_site_verification:</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Google Analytics</span></span><br><span class="line">        <span class="comment">#google_analytics:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># CNZZ count</span></span><br><span class="line">        <span class="comment">#cnzz_siteid:</span></span><br><span class="line">        </span><br><span class="line">        // 设置多说的信息</span><br><span class="line">        <span class="comment"># Make duoshuo show UA</span></span><br><span class="line">        <span class="comment"># user_id must NOT be null when admin_enable is true!</span></span><br><span class="line">        <span class="comment"># you can visit http://dev.duoshuo.com get duoshuo user id.</span></span><br><span class="line">        duoshuo_info:</span><br><span class="line">          ua_<span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">          admin_<span class="built_in">enable</span>: <span class="literal">false</span></span><br><span class="line">          user_id: 0</span><br><span class="line">          <span class="comment">#admin_nickname: Author</span></span><br><span class="line">          Author: hello</span><br><span class="line">        </span><br><span class="line">        // 设置Facebook信息</span><br><span class="line">        <span class="comment"># Facebook SDK Support.</span></span><br><span class="line">        <span class="comment"># https://github.com/iissnan/hexo-theme-next/pull/410</span></span><br><span class="line">        facebook_sdk:</span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">false</span></span><br><span class="line">          app_id:       <span class="comment">#&lt;app_id&gt;</span></span><br><span class="line">          fb_admin:     <span class="comment">#&lt;user_id&gt;</span></span><br><span class="line">          like_button:  <span class="comment">#true</span></span><br><span class="line">          webmaster:    <span class="comment">#true</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Show number of visitors to each article.</span></span><br><span class="line">        <span class="comment"># You can visit https://leancloud.cn get AppID and AppKey.</span></span><br><span class="line">        leancloud_visitors:</span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">false</span></span><br><span class="line">          app_id: <span class="comment">#&lt;app_id&gt;</span></span><br><span class="line">          app_key: <span class="comment">#&lt;app_key&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Show PV/UV of the website/page with busuanzi.</span></span><br><span class="line">        <span class="comment"># Get more information on http://ibruce.info/2015/04/04/busuanzi/</span></span><br><span class="line">        busuanzi_count:</span><br><span class="line">          <span class="comment"># count values only if the other configs are false</span></span><br><span class="line">          <span class="built_in">enable</span>: <span class="literal">false</span></span><br><span class="line">          <span class="comment"># custom uv span for the whole site</span></span><br><span class="line">          site_uv: <span class="literal">true</span></span><br><span class="line">          site_uv_header: &lt;i class=<span class="string">"fa fa-user"</span>&gt;&lt;/i&gt;</span><br><span class="line">          site_uv_footer: </span><br><span class="line">          <span class="comment"># custom pv span for the whole site</span></span><br><span class="line">          site_pv: <span class="literal">true</span></span><br><span class="line">          site_pv_header: &lt;i class=<span class="string">"fa fa-eye"</span>&gt;&lt;/i&gt;</span><br><span class="line">          site_pv_footer: </span><br><span class="line">          <span class="comment"># custom pv span for one page only</span></span><br><span class="line">          page_pv: <span class="literal">true</span></span><br><span class="line">          page_pv_header: &lt;i class=<span class="string">"fa fa-file-o"</span>&gt;&lt;/i&gt;</span><br><span class="line">          page_pv_footer: </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Tencent analytics ID</span></span><br><span class="line">        <span class="comment"># tencent_analytics:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Enable baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO</span></span><br><span class="line">        baidu_push: <span class="literal">false</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">#! ---------------------------------------------------------------</span></span><br><span class="line">        <span class="comment">#! DO NOT EDIT THE FOLLOWING SETTINGS</span></span><br><span class="line">        <span class="comment">#! UNLESS YOU KNOW WHAT YOU ARE DOING</span></span><br><span class="line">        <span class="comment">#! ---------------------------------------------------------------</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Motion</span></span><br><span class="line">        use_motion: <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Fancybox</span></span><br><span class="line">        fancybox: <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Script Vendors.</span></span><br><span class="line">        <span class="comment"># Set a CDN address for the vendor you want to customize.</span></span><br><span class="line">        <span class="comment"># For example</span></span><br><span class="line">        <span class="comment">#    jquery: https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js</span></span><br><span class="line">        <span class="comment"># Be aware that you should use the same version as internal ones to avoid potential problems.</span></span><br><span class="line">        vendors:</span><br><span class="line">          <span class="comment"># Internal path prefix. Please do not edit it.</span></span><br><span class="line">          _internal: vendors</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Internal version: 2.1.3</span></span><br><span class="line">          jquery:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Internal version: 2.1.5</span></span><br><span class="line">          fancybox:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Internal version: 1.0.6</span></span><br><span class="line">          fastclick:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Internal version: 1.9.7</span></span><br><span class="line">          lazyload:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Internal version: 1.2.1</span></span><br><span class="line">          velocity:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Internal version: 1.2.1</span></span><br><span class="line">          velocity_ui:</span><br><span class="line">        </span><br><span class="line">          <span class="comment"># Internal version: 0.7.9</span></span><br><span class="line">          ua_parser:</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Assets</span></span><br><span class="line">        css: css</span><br><span class="line">        js: js</span><br><span class="line">        images: images</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Theme version</span></span><br><span class="line">        version: 5.0.1</span><br><span class="line">        </span><br><span class="line">        // 这里设置的是打赏的信息</span><br><span class="line">        <span class="comment"># Donate 文章末尾显示打赏按钮</span></span><br><span class="line">        reward_comment: 如果觉得写的不错，那就打赏一下吧！ // 文字提示</span><br><span class="line">        wechatpay: /uploads/weixin.png  //微信图片(本地图片或网络图片)</span><br><span class="line">        <span class="comment">#alipay: 此处为支付宝向我付款二维码图片的相对或者是绝对URL</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment">### 分类和标签</span></span><br><span class="line"></span><br><span class="line">- 添加分类</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="built_in">cd</span> hexo   // 进入博客路径</span><br><span class="line">hexo new page categories  // 创建分类页面</span><br></pre></td></tr></table></figure>
<p>然后进入到hexo\source\ categories路径下打开index.md文件，编辑保存。</p>
<pre><code>---
title: categories
date: 2016-04-26 16:17:21
 type: &quot;categories&quot;
---
</code></pre><p>在主题配置文件里设置</p>
<pre><code>menu:
    home: /
    archives: archives
    categories: categories   // 如果有问题在前面加一个反斜杠
    tags: tags
    #about: about
    #commonweal: /404.html
</code></pre><ul>
<li>添加标签</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> hexo   // 进入博客路径</span><br><span class="line">hexo new page tags  // 创建分类页面</span><br></pre></td></tr></table></figure>
<p>然后进入到hexo\source\ tags路径下打开index.md文件，编辑保存。</p>
<pre><code>---
title: tags
date: 2016-04-26 16:17:21
 type: &quot;tags&quot;
---
</code></pre><p>在主题配置文件里设置</p>
<pre><code>menu:
    home: /
    archives: archives
    categories: categories   
    tags: tags  // 如果有问题在前面加一个反斜杠
    #about: about
    #commonweal: /404.html
</code></pre><p>最后发表一篇文章（设置好分类和标签），执行一下命令查看结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo s</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>
<h3 id="头像"><a href="#头像" class="headerlink" title="头像"></a>头像</h3><p>要在 source 路径下创建文件夹 uploads ，然后将要设置的图片拷到这里，设置如下</p>
<pre><code>avatar: /uploads/avatar.png   // 在主题配置文件里设置（也可以用网络链接）
</code></pre><h3 id="打赏"><a href="#打赏" class="headerlink" title="打赏"></a>打赏</h3><p>在主题配置文件底部添加以下代码：</p>
<pre><code>// 这里设置的是打赏的信息
# Donate 文章末尾显示打赏按钮
reward_comment: 如果觉得写的不错，那就打赏一下吧！ // 文字提示
wechatpay: /uploads/weixin.png  //微信图片(本地图片或网络图片)
#alipay: 此处为支付宝向我付款二维码图片的相对或者是绝对URL
</code></pre><p>图片的设置同头像设置一致。</p>
<h3 id="多说评论"><a href="#多说评论" class="headerlink" title="多说评论"></a>多说评论</h3><p>额，以为很麻烦，所以一开始没有设置，后来有时间想设置一下，发现 so easy！</p>
<p>先到<a href="http://duoshuo.com/" target="_blank" rel="external">多说</a> 去申请一个站点，步骤如下：</p>
<p>1.登录后在首页选择 <code>我要安装</code>。</p>
<p>2.创建站点，填写表格，<strong>多说域名</strong>这一栏填写的即是你的 <code>duoshuo_shortname</code>，如图：</p>
<p><img src="http://theme-next.iissnan.com/uploads/five-minutes-setup/duoshuo-create-site.png" alt=""></p>
<p>3.创建站点完成后在 <code>站点配置文件</code> 中新增 duoshuo_shortname 字段，值设置成上一步中的值。</p>
<p>不用别的操作，只有3步就搞定。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上的设置只是一些基本的设置，先把博客用起来，后面在慢慢的去了解，去深入。关于404公益页面，域名，统计，搜索等功能暂未实现，感觉博客没必要弄那么多不必要的功能，如果你感兴趣可以去研究一下。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/25/Welcome To Hexo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东折">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Try and try again！The worst result is failure!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/25/Welcome To Hexo/" itemprop="url">Welcome To Hexo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-25T00:00:00+08:00">
                2016-04-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo/" itemprop="url" rel="index">
                    <span itemprop="name">hexo</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/25/Welcome To Hexo/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/25/Welcome To Hexo/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/08/MacDown 使用说明/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东折">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Try and try again！The worst result is failure!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/08/MacDown 使用说明/" itemprop="url">MacDown中MarkDown的使用规范总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-08T00:00:00+08:00">
                2016-04-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/08/MacDown 使用说明/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/08/MacDown 使用说明/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>Created by 东折 on  8 April 2016</strong></p>
<h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h2><p>在MarkDown中，你只需要在文本前面加上#即可。同理，你可以增加二级标题、三级标题、四级标题、五级标题、六级标题，总共六级，只需增加#即可。标题字号相应降低，例如：</p>
<pre><code>#一级标题
##二级标题
###三级标题
####四级标题
#####五级标题
######六级标题
</code></pre><p>注：#和「一级标题」之间建议保留一个字符的空格，这是最标准的MarkDown写法</p>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><ul>
<li><p>在MarkDown中，你只需要在文字卡面加上-或+就可以了，例如：</p>
<pre><code>- 文本一
- 文本二
- 文本三
</code></pre></li>
<li><p>如果你希望有序列表，在文字前面加上1. 2. 3. 就可以了，例如：</p>
<pre><code>1. 文本一
2. 文本二
3. 文本三
</code></pre></li>
<li><p>效果如下(前面的&gt;符号表示引用),如果「- 文本」不是放在行首，显示的就是空心圆 ：</p>
<blockquote>
<ul>
<li>文本一</li>
<li>文本二</li>
<li>文本三</li>
</ul>
<ol>
<li>文本一</li>
<li>文本二</li>
<li>文本三</li>
</ol>
</blockquote>
</li>
</ul>
<p>注：-和1. 和文本之间保留一个空格，但是后面要跟代码时，代码需要两个制表符(Tab)或8个空格，才能正常显示。</p>
<h2 id="链接、超链接、图片和代码"><a href="#链接、超链接、图片和代码" class="headerlink" title="链接、超链接、图片和代码"></a>链接、超链接、图片和代码</h2><ul>
<li><p>在MarkDown中，插入链接时，只需要使用 [使用文本](链接地址)这样的语法就可以，例如：</p>
<p>  <a href="https://uranusjr.com/work/" target="_blank" rel="external">MarkDown</a></p>
</li>
<li><p>在MarkDown中，插入超链接(网址、邮箱等)时，只需要将超链接用&lt;&gt;包括起来即可，例如：</p>
<p>  <a href="&#109;&#97;&#105;&#108;&#116;&#x6f;&#x3a;&#49;&#x32;&#51;&#x34;&#x35;&#54;&#55;&#56;&#x39;&#64;&#x31;&#x36;&#x33;&#x2e;&#99;&#x6f;&#109;">&#49;&#x32;&#51;&#x34;&#x35;&#54;&#55;&#56;&#x39;&#64;&#x31;&#x36;&#x33;&#x2e;&#99;&#x6f;&#109;</a></p>
<p>  <a href="http://www.jianshu.com" target="_blank" rel="external">http://www.jianshu.com</a></p>
</li>
</ul>
<ul>
<li><p>在MarkDown中，插入图片时，只需要使用![](图片链接地址)这样的语法就可以，例如：<br>  <img src="http://macdown.uranusjr.com/static/base/img/logo.png" alt=""></p>
</li>
<li><p>在MarkDown中，建立代码区块，只要在文本前添加制表符或者4个空格就可以，例如：</p>
<pre><code>- (void)hello
{
      nslog(@&quot;hello world&quot;);
}
</code></pre></li>
</ul>
<p>注：插入图片的语法和链接的语法很像，只是前面多了一个 !。这里的[],(),!符号都是英文符号。</p>
<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><p>格式如下：</p>
<ul>
<li><p>行名居中，数据居左</p>
<p>  | Tables        | Are           |  Cool   |<br>  | —— |——-| —–|<br>  | col 3 is      | right-aligned | $1600 |<br>  | col 2 is      | centered      |   $12 |<br>  | zebra stripes | are neat     |    $1  |</p>
<pre><code>[^emphasize]
</code></pre></li>
<li><p>行名居中，数据居中</p>
<p>  | Tables        | Are           |  Cool   |<br>  | :—–: |:——-:| :—–:|<br>  | col 3 is      | right-aligned | $1600 |<br>  | col 2 is      | centered      |   $12 |<br>  | zebra stripes | are neat     |    $1  |</p>
</li>
<li><p>行名居左，数据居左</p>
<p>  | Tables        | Are           |  Cool   |<br>  | :—— |:——-| :—–|<br>  | col 3 is      | right-aligned | $1600 |<br>  | col 2 is      | centered      |   $12 |<br>  | zebra stripes | are neat     |    $1  |</p>
</li>
<li><p>行名居右，数据居右</p>
<p>  | Tables        | Are           |  Cool   |<br>  | ——: |——-:| —–:|<br>  | col 3 is      | right-aligned | $1600 |<br>  | col 2 is      | centered      |   $12 |<br>  | zebra stripes | are neat     |    $1  |</p>
</li>
</ul>
<p>注：两边的竖线可有可无，但是要有都有，要无都无。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li><p>回车</p>
<blockquote>
<p>一个回车表示换行</p>
<p>两个回车表示换段</p>
</blockquote>
</li>
<li><p>引用</p>
<p>  在Markdown中你只需要在你希望引用的文字前面添加&gt;就可以，例如：</p>
<blockquote>
<p>一盏灯，一片黄昏；</p>
</blockquote>
<p>  注：&gt; 和 文本之间建议保留一个空格</p>
</li>
<li><p>粗体与斜体</p>
<p>  在MarkDown中，用两个<em>包含一段文字就是粗体，用一个</em>包含一段文字就是斜体，例如：</p>
<pre><code>**粗体**

*斜体*

***粗斜体***
</code></pre></li>
</ul>
<ul>
<li><p>横线</p>
<p>  三个星号或者三个减号或者三个下划线即可生成一条虚横线，例如：</p>
<pre><code>***
---
___
</code></pre><p>  一个减号或两个减号，可以生成一条实横线，例如：</p>
<pre><code>-
--
</code></pre></li>
<li><p>删除线</p>
</li>
</ul>
<ul>
<li><p>文本突出显示</p>
<p>  只需要用``将文本包含起来，即可。例如：</p>
<p>  <code>突出显示文本</code></p>
</li>
<li><p>文本注释</p>
<p>  只需使用[^注释]这样的格式，就可以，但是要在文章最后面也要有相同的[^注释]去解释相应的内容，例如：</p>
<pre><code>[^hello]
</code></pre></li>
<li><p>特殊符号</p>
<p>  文本中需要插入特殊符号时，需要在特殊符号前加上反斜杠，例如：</p>
<p>  #hello</p>
<p>  注：这里的特殊符号并不只是只单一的特殊符号，而是当特殊符号与文本或特殊符号组合形成特殊的格式时，如果需要显示特殊符号，需要加上\。如上面的#与hello组合会将hello显示为标题，如果此时需要显示#hello，需要在#前添加\。</p>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上的语法只是MarkDown的基本语法，在实际使用中往往是多个语法混合使用，具体的规则要在具体的使用中去体会。个人觉得用MarkDown来记笔记要比使用简单地文本方便得多，而且写出的东西也更加易读。</p>
<p>Okey，happy writing！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="东折" />
          <p class="site-author-name" itemprop="name">东折</p>
           
              <p class="site-description motion-element" itemprop="description">君子见大水必观焉，何也？-- 其万折也必东，似志 ！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">东折</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"yulncbd"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  
















  





  

  

  

  

  

</body>
</html>
